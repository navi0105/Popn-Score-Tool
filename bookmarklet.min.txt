javascript:(function%20()%20%7B%20'use%20strict'%3B%20var%20GAME_BASE%20%3D%20'%2Fgame%2Fpopn%2Fjamfizz'%3B%20var%20MAX_LEVEL%20%3D%2050%3B%20var%20PAGE_DELAY%20%3D%20400%3B%20var%20DETAIL_DELAY%20%3D%20300%3B%20var%20isRunning%20%3D%20false%3B%20var%20stopRequested%20%3D%20false%3B%20var%20collectedData%20%3D%20%7B%20player%3A%20null%2C%20scores%3A%20%5B%5D%2C%20exportedAt%3A%20null%2C%20%7D%3B%20var%20MEDAL_MAP%20%3D%20%7B%20'meda_none'%3A%20'no_play'%2C%20'meda_k'%3A%20'easy_clear'%2C%20'meda_j'%3A%20'failed_1'%2C%20'meda_i'%3A%20'failed_2'%2C%20'meda_h'%3A%20'failed_3'%2C%20'meda_g'%3A%20'normal_clear'%2C%20'meda_f'%3A%20'normal_clear_in_20_bad'%2C%20'meda_e'%3A%20'normal_clear_in_5_bad'%2C%20'meda_d'%3A%20'full_combo'%2C%20'meda_c'%3A%20'full_combo_in_20_good'%2C%20'meda_b'%3A%20'full_combo_in_5_good'%2C%20'meda_a'%3A%20'perfect'%2C%20%7D%3B%20var%20RANK_MAP%20%3D%20%7B%20'rank_none'%3A%20null%2C%20'rank_e'%3A%20'E'%2C%20'rank_d'%3A%20'D'%2C%20'rank_c'%3A%20'C'%2C%20'rank_b'%3A%20'B'%2C%20'rank_a1'%3A%20'A'%2C%20'rank_a2'%3A%20'AA'%2C%20'rank_a3'%3A%20'AAA'%2C%20'rank_s'%3A%20'S'%2C%20%7D%3B%20function%20extractMedal(imgSrc)%20%7B%20if%20(!imgSrc)%20return%20null%3B%20var%20match%20%3D%20imgSrc.match(%2Fmedal%5C%2F(meda_%5Ba-z_%5D%2B)%5C.png%2F)%3B%20return%20match%20%3F%20(MEDAL_MAP%5Bmatch%5B1%5D%5D%20%7C%7C%20match%5B1%5D)%20%3A%20null%3B%20%7D%20function%20extractRank(imgSrc)%20%7B%20if%20(!imgSrc)%20return%20null%3B%20var%20match%20%3D%20imgSrc.match(%2Fmedal%5C%2F(rank_%5Ba-z0-9_%5D%2B)%5C.png%2F)%3B%20return%20match%20%3F%20(RANK_MAP%5Bmatch%5B1%5D%5D%20!%3D%3D%20undefined%20%3F%20RANK_MAP%5Bmatch%5B1%5D%5D%20%3A%20match%5B1%5D)%20%3A%20null%3B%20%7D%20function%20extractScore(colDiv)%20%7B%20var%20text%20%3D%20colDiv.textContent.trim()%3B%20if%20(text%20%3D%3D%3D%20'-'%20%7C%7C%20text%20%3D%3D%3D%20'')%20return%20null%3B%20var%20num%20%3D%20parseInt(text.replace(%2F%5B%5E0-9%5D%2Fg%2C%20''))%3B%20return%20isNaN(num)%20%3F%20null%20%3A%20num%3B%20%7D%20function%20createUI()%20%7B%20if%20(document.getElementById('popnme'))%20%7B%20document.getElementById('popnme').remove()%3B%20%7D%20var%20overlay%20%3D%20document.createElement('div')%3B%20overlay.id%20%3D%20'popnme'%3B%20overlay.innerHTML%20%3D%20'%5C%20%3Cstyle%3E%5C%20%23popnme%20%7B%5C%20position%3A%20fixed%3B%20top%3A%200%3B%20left%3A%200%3B%20right%3A%200%3B%20bottom%3A%200%3B%5C%20background%3A%20rgba(0%2C0%2C0%2C0.4)%3B%20z-index%3A%2099999%3B%5C%20display%3A%20flex%3B%20align-items%3A%20center%3B%20justify-content%3A%20center%3B%5C%20font-family%3A%20sans-serif%3B%20color%3A%20%233d2b1f%3B%5C%20%7D%5C%20%23popnme%20.panel%20%7B%5C%20background%3A%20%23fef6f0%3B%20border-radius%3A%2012px%3B%20padding%3A%2030px%3B%5C%20max-width%3A%20520px%3B%20width%3A%2090%25%3B%5C%20box-shadow%3A%200%204px%2024px%20rgba(0%2C0%2C0%2C0.15)%3B%5C%20%7D%5C%20%23popnme%20h2%20%7B%20margin%3A%200%200%204px%200%3B%20color%3A%20%23e94560%3B%20%7D%5C%20%23popnme%20.subtitle%20%7B%20color%3A%20%23907860%3B%20margin%3A%200%200%2020px%200%3B%20font-size%3A%2013px%3B%20%7D%5C%20%23popnme%20.msg1%20%7B%20font-size%3A%2014px%3B%20color%3A%20%232e7ed6%3B%20margin%3A%208px%200%204px%200%3B%20%7D%5C%20%23popnme%20.msg2%20%7B%20font-size%3A%2012px%3B%20color%3A%20%23907860%3B%20margin%3A%200%200%208px%200%3B%20%7D%5C%20%23popnme%20.progress-bar%20%7B%5C%20width%3A%20100%25%3B%20height%3A%206px%3B%20background%3A%20%23ffe0d0%3B%5C%20border-radius%3A%203px%3B%20margin%3A%2010px%200%3B%20overflow%3A%20hidden%3B%5C%20%7D%5C%20%23popnme%20.progress-fill%20%7B%5C%20height%3A%20100%25%3B%20width%3A%200%25%3B%20background%3A%20%23e94560%3B%5C%20border-radius%3A%203px%3B%20transition%3A%20width%200.3s%3B%5C%20%7D%5C%20%23popnme%20button%20%7B%5C%20padding%3A%208px%2020px%3B%20border%3A%20none%3B%20border-radius%3A%206px%3B%5C%20color%3A%20%23fff%3B%20cursor%3A%20pointer%3B%20margin%3A%203px%3B%20font-size%3A%2013px%3B%5C%20%7D%5C%20%23popnme%20button%3Ahover%3Anot(%3Adisabled)%20%7B%20opacity%3A%200.8%3B%20%7D%5C%20%23popnme%20button%3Adisabled%20%7B%20opacity%3A%200.4%3B%20cursor%3A%20not-allowed%3B%20%7D%5C%20%23popnme%20.btn-quick%20%7B%20background%3A%20%23e94560%3B%20%7D%5C%20%23popnme%20.btn-stop%20%7B%20background%3A%20%23b0a090%3B%20%7D%5C%20%23popnme%20.btn-close%20%7B%20background%3A%20%23907860%3B%20%7D%5C%20%23popnme%20.btn-export%20%7B%20background%3A%20%232ecc71%3B%20%7D%5C%20%23popnme%20.btn-html%20%7B%20background%3A%20%234a8fe7%3B%20%7D%5C%20%23popnme%20.btn-img%20%7B%20background%3A%20%23d08a10%3B%20%7D%5C%20%23popnme%20.btn-deep%20%7B%20background%3A%20%23b06ce0%3B%20%7D%5C%20%23popnme%20.btn-dump%20%7B%20background%3A%20%238b5cf6%3B%20%7D%5C%20%23popnme%20.logger%20%7B%5C%20max-height%3A%20180px%3B%20overflow-y%3A%20auto%3B%20font-size%3A%2011px%3B%5C%20background%3A%20%23fff0ea%3B%20border%3A%201px%20solid%20%23f0c8b0%3B%20border-radius%3A%206px%3B%20padding%3A%2010px%3B%5C%20color%3A%20%231ea868%3B%20font-family%3A%20monospace%3B%20margin-top%3A%2012px%3B%5C%20%7D%5C%20%23popnme%20.logger%20p%20%7B%20margin%3A%202px%200%3B%20%7D%5C%20%23popnme%20.mode-desc%20%7B%20font-size%3A%2011px%3B%20color%3A%20%23907860%3B%20margin%3A%204px%200%2010px%200%3B%20%7D%5C%20%3C%2Fstyle%3E%5C%20%3Cdiv%20class%3D%22panel%22%3E%5C%20%3Ch2%3EPop%5C'n%20Score%20Tool%3C%2Fh2%3E%5C%20%3Cp%20class%3D%22subtitle%22%3Epop%5C'n%20music%20score%20exporter%3C%2Fp%3E%5C%20%3Cp%20class%3D%22msg1%22%20id%3D%22popnme_msg1%22%3EInitializing...%3C%2Fp%3E%5C%20%3Cp%20class%3D%22msg2%22%20id%3D%22popnme_msg2%22%3E%3C%2Fp%3E%5C%20%3Cdiv%20class%3D%22progress-bar%22%3E%3Cdiv%20class%3D%22progress-fill%22%20id%3D%22popnme_progress%22%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%5C%20%3Cdiv%3E%5C%20%3Cbutton%20class%3D%22btn-quick%22%20id%3D%22popnme_btn_quick%22%3EScrape%3C%2Fbutton%3E%5C%20%3C!--%20%5BDEV%5D%20Deep%20Scrape%3A%20hidden%20for%20v1%2C%20enable%20for%20per-song%20detail%20fetching%20--%3E%5C%20%3C!--%20%3Cbutton%20class%3D%22btn-deep%22%20id%3D%22popnme_btn_deep%22%3EDeep%20Scrape%3C%2Fbutton%3E%20--%3E%5C%20%3C!--%20%5BDEV%5D%20Export%20JSON%3A%20hidden%20for%20v1%2C%20enable%20for%20raw%20JSON%20export%20--%3E%5C%20%3C!--%20%3Cbutton%20class%3D%22btn-export%22%20id%3D%22popnme_btn_export%22%20disabled%3EExport%20JSON%3C%2Fbutton%3E%20--%3E%5C%20%3Cbutton%20class%3D%22btn-html%22%20id%3D%22popnme_btn_html%22%20disabled%3EExport%20HTML%3C%2Fbutton%3E%5C%20%3Cbutton%20class%3D%22btn-img%22%20id%3D%22popnme_btn_img%22%20disabled%3EExport%20Image%3C%2Fbutton%3E%5C%20%3C!--%20%5BDEV%5D%20Dump%20HTML%3A%20hidden%20for%20v1%2C%20enable%20for%20raw%20page%20HTML%20dump%20--%3E%5C%20%3C!--%20%3Cbutton%20class%3D%22btn-dump%22%20id%3D%22popnme_btn_dump%22%3EDump%20HTML%3C%2Fbutton%3E%20--%3E%5C%20%3Cbutton%20class%3D%22btn-stop%22%20id%3D%22popnme_btn_stop%22%20disabled%3EStop%3C%2Fbutton%3E%5C%20%3Cbutton%20class%3D%22btn-close%22%20id%3D%22popnme_btn_close%22%3EClose%3C%2Fbutton%3E%5C%20%3C%2Fdiv%3E%5C%20%3Cdiv%20class%3D%22logger%22%20id%3D%22popnme_logger%22%3E%3C%2Fdiv%3E%5C%20%3C%2Fdiv%3E'%3B%20document.body.appendChild(overlay)%3B%20document.getElementById('popnme_btn_quick').addEventListener('click'%2C%20function()%20%7B%20startUpdate(false)%3B%20%7D)%3B%20document.getElementById('popnme_btn_html').addEventListener('click'%2C%20exportViewerHTML)%3B%20document.getElementById('popnme_btn_img').addEventListener('click'%2C%20exportClassImage)%3B%20document.getElementById('popnme_btn_stop').addEventListener('click'%2C%20requestStop)%3B%20document.getElementById('popnme_btn_close').addEventListener('click'%2C%20function()%20%7B%20overlay.remove()%3B%20%7D)%3B%20%7D%20function%20log(msg)%20%7B%20console.log('%5Bpopnme%5D'%2C%20msg)%3B%20var%20logger%20%3D%20document.getElementById('popnme_logger')%3B%20if%20(logger)%20%7B%20var%20p%20%3D%20document.createElement('p')%3B%20p.textContent%20%3D%20msg%3B%20logger.insertBefore(p%2C%20logger.firstChild)%3B%20%7D%20%7D%20function%20setMsg1(msg)%20%7B%20var%20el%20%3D%20document.getElementById('popnme_msg1')%3B%20if%20(el)%20el.textContent%20%3D%20msg%3B%20%7D%20function%20setMsg2(msg)%20%7B%20var%20el%20%3D%20document.getElementById('popnme_msg2')%3B%20if%20(el)%20el.textContent%20%3D%20msg%3B%20%7D%20function%20setProgress(ratio)%20%7B%20var%20el%20%3D%20document.getElementById('popnme_progress')%3B%20if%20(el)%20el.style.width%20%3D%20(ratio%20*%20100)%20%2B%20'%25'%3B%20%7D%20function%20setButtonState(phase)%20%7B%20var%20btnQuick%20%3D%20document.getElementById('popnme_btn_quick')%3B%20var%20btnHtml%20%3D%20document.getElementById('popnme_btn_html')%3B%20var%20btnImg%20%3D%20document.getElementById('popnme_btn_img')%3B%20var%20btnStop%20%3D%20document.getElementById('popnme_btn_stop')%3B%20var%20hasData%20%3D%20collectedData.scores.length%20%3E%200%3B%20if%20(phase%20%3D%3D%3D%20'running')%20%7B%20btnQuick.disabled%20%3D%20true%3B%20btnStop.disabled%20%3D%20false%3B%20btnHtml.disabled%20%3D%20true%3B%20btnImg.disabled%20%3D%20true%3B%20%7D%20else%20if%20(phase%20%3D%3D%3D%20'done')%20%7B%20btnQuick.disabled%20%3D%20false%3B%20btnStop.disabled%20%3D%20true%3B%20btnHtml.disabled%20%3D%20false%3B%20btnImg.disabled%20%3D%20false%3B%20%7D%20else%20%7B%20btnQuick.disabled%20%3D%20false%3B%20btnStop.disabled%20%3D%20true%3B%20btnHtml.disabled%20%3D%20!hasData%3B%20btnImg.disabled%20%3D%20!hasData%3B%20%7D%20%7D%20function%20fetchPage(url)%20%7B%20return%20new%20Promise(function(resolve%2C%20reject)%20%7B%20var%20xhr%20%3D%20new%20XMLHttpRequest()%3B%20xhr.open('GET'%2C%20url)%3B%20xhr.onload%20%3D%20function%20()%20%7B%20if%20(this.responseURL%20%26%26%20this.responseURL.indexOf('error.html')%20%3E%200)%20%7B%20var%20errcode%20%3D%20this.responseURL.slice(-1)%3B%20var%20errors%20%3D%20%7B%20'1'%3A%20'Need%20e-amusement%20Basic%20Course'%2C%20'2'%3A%20'Need%20to%20register%20game%20card'%2C%20'3'%3A%20'No%20play%20data%20found'%2C%20'4'%3A%20'e-amusement%20server%20error'%2C%20'5'%3A%20'Need%20Premium%20Course'%2C%20%7D%3B%20reject(new%20Error(errors%5Berrcode%5D%20%7C%7C%20'Unknown%20eagate%20error'))%3B%20return%3B%20%7D%20if%20(this.status%20%3D%3D%3D%20200)%20%7B%20resolve(this.responseText)%3B%20%7D%20else%20%7B%20reject(new%20Error('HTTP%20'%20%2B%20this.status))%3B%20%7D%20%7D%3B%20xhr.onerror%20%3D%20function%20()%20%7B%20reject(new%20Error('Network%20error'))%3B%20%7D%3B%20xhr.send()%3B%20%7D)%3B%20%7D%20function%20parseHTML(html)%20%7B%20return%20new%20DOMParser().parseFromString(html%2C%20'text%2Fhtml')%3B%20%7D%20function%20delay(ms)%20%7B%20return%20new%20Promise(function(resolve)%20%7B%20setTimeout(resolve%2C%20ms)%3B%20%7D)%3B%20%7D%20function%20fetchImageAsDataURL(url)%20%7B%20return%20new%20Promise(function(resolve%2C%20reject)%20%7B%20var%20xhr%20%3D%20new%20XMLHttpRequest()%3B%20xhr.open('GET'%2C%20url)%3B%20xhr.responseType%20%3D%20'blob'%3B%20xhr.onload%20%3D%20function%20()%20%7B%20if%20(this.status%20%3D%3D%3D%20200)%20%7B%20var%20reader%20%3D%20new%20FileReader()%3B%20reader.onloadend%20%3D%20function%20()%20%7B%20resolve(reader.result)%3B%20%7D%3B%20reader.readAsDataURL(this.response)%3B%20%7D%20else%20%7B%20reject(new%20Error('HTTP%20'%20%2B%20this.status))%3B%20%7D%20%7D%3B%20xhr.onerror%20%3D%20function%20()%20%7B%20reject(new%20Error('Network%20error'))%3B%20%7D%3B%20xhr.send()%3B%20%7D)%3B%20%7D%20function%20buildMuLvURL(lv%2C%20page)%20%7B%20return%20GAME_BASE%20%2B%20'%2Fplaydata%2Fmu_lv.html%3Fpage%3D'%20%2B%20page%20%2B%20'%26version%3D0%26category%3D0%26keyword%3D%26lv%3D'%20%2B%20lv%3B%20%7D%20function%20parseStatusPage(doc)%20%7B%20var%20data%20%3D%20%7B%7D%3B%20doc.querySelectorAll('div.st_box%20div.item').forEach(function(itemEl)%20%7B%20var%20label%20%3D%20itemEl.textContent.trim().replace(%2F%5E%E2%97%86%2F%2C%20'')%3B%20var%20valueEl%20%3D%20itemEl.nextElementSibling%3B%20if%20(!valueEl%20%7C%7C%20!valueEl.classList.contains('item_st'))%20return%3B%20var%20img%20%3D%20valueEl.querySelector('img')%3B%20if%20(img)%20%7B%20data%5Blabel%5D%20%3D%20%7B%20text%3A%20valueEl.textContent.trim()%2C%20img%3A%20img.getAttribute('src')%20%7D%3B%20%7D%20else%20%7B%20data%5Blabel%5D%20%3D%20valueEl.textContent.trim()%3B%20%7D%20%7D)%3B%20var%20charaEl%20%3D%20doc.querySelector('%23chara')%3B%20if%20(charaEl)%20%7B%20var%20charaImg%20%3D%20charaEl.querySelector('img')%3B%20data%5B'%E4%BD%BF%E7%94%A8%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%BC'%5D%20%3D%20%7B%20name%3A%20charaEl.textContent.trim()%2C%20img%3A%20charaImg%20%3F%20charaImg.getAttribute('src')%20%3A%20null%2C%20%7D%3B%20%7D%20var%20battleCells%20%3D%20doc.querySelectorAll('table%23net_win_table%20tbody%20tr%3Anth-child(2)%20td')%3B%20if%20(battleCells.length%20%3E%3D%204)%20%7B%20data%5B'battle_record'%5D%20%3D%20%7B%20'1st'%3A%20parseInt(battleCells%5B0%5D.textContent)%20%7C%7C%200%2C%20'2nd'%3A%20parseInt(battleCells%5B1%5D.textContent)%20%7C%7C%200%2C%20'3rd'%3A%20parseInt(battleCells%5B2%5D.textContent)%20%7C%7C%200%2C%20'4th'%3A%20parseInt(battleCells%5B3%5D.textContent)%20%7C%7C%200%2C%20%7D%3B%20%7D%20return%20data%3B%20%7D%20function%20parseMuLvPage(doc)%20%7B%20var%20entries%20%3D%20%5B%5D%3B%20var%20rows%20%3D%20doc.querySelectorAll('ul.mu_list_table%20%3E%20li')%3B%20for%20(var%20i%20%3D%201%3B%20i%20%3C%20rows.length%3B%20i%2B%2B)%20%7B%20var%20li%20%3D%20rows%5Bi%5D%3B%20var%20colMusic%20%3D%20li.querySelector('div.col_music_lv')%3B%20if%20(!colMusic)%20continue%3B%20var%20titleLink%20%3D%20colMusic.querySelector('a')%3B%20var%20subDivs%20%3D%20colMusic.querySelectorAll('div')%3B%20var%20diffText%20%3D%20''%3B%20var%20diffEl%20%3D%20li.querySelector('div.col_normal_lv')%3B%20if%20(diffEl)%20diffText%20%3D%20diffEl.textContent.trim().toLowerCase()%3B%20var%20levelText%20%3D%20''%3B%20var%20levelEl%20%3D%20li.querySelector('div.col_hyper_lv')%3B%20if%20(levelEl)%20levelText%20%3D%20levelEl.textContent.trim()%3B%20var%20scoreCol%20%3D%20li.querySelector('div.col_ex_lv')%3B%20var%20score%20%3D%20null%3B%20var%20medalSrc%20%3D%20null%3B%20var%20rankSrc%20%3D%20null%3B%20if%20(scoreCol)%20%7B%20var%20imgs%20%3D%20scoreCol.querySelectorAll('img')%3B%20medalSrc%20%3D%20imgs%5B0%5D%20%3F%20imgs%5B0%5D.getAttribute('src')%20%3A%20null%3B%20rankSrc%20%3D%20imgs%5B1%5D%20%3F%20imgs%5B1%5D.getAttribute('src')%20%3A%20null%3B%20score%20%3D%20extractScore(scoreCol)%3B%20%7D%20entries.push(%7B%20title%3A%20titleLink%20%3F%20titleLink.textContent.trim()%20%3A%20''%2C%20detailUrl%3A%20titleLink%20%3F%20titleLink.getAttribute('href')%20%3A%20null%2C%20genre%3A%20subDivs%5B0%5D%20%3F%20subDivs%5B0%5D.textContent.trim()%20%3A%20''%2C%20artist%3A%20subDivs%5B1%5D%20%3F%20subDivs%5B1%5D.textContent.trim()%20%3A%20''%2C%20difficulty%3A%20diffText%2C%20level%3A%20parseInt(levelText)%20%7C%7C%20null%2C%20score%3A%20score%2C%20medal%3A%20extractMedal(medalSrc)%2C%20rank%3A%20extractRank(rankSrc)%2C%20medalImg%3A%20medalSrc%2C%20rankImg%3A%20rankSrc%2C%20%7D)%3B%20%7D%20return%20entries%3B%20%7D%20function%20parseDetailPage(doc)%20%7B%20var%20detail%20%3D%20%7B%7D%3B%20var%20titleEl%20%3D%20doc.querySelector('%23title')%3B%20if%20(titleEl)%20detail.title%20%3D%20titleEl.textContent.trim()%3B%20var%20artistEl%20%3D%20doc.querySelector('%23artist')%3B%20if%20(artistEl)%20detail.artist%20%3D%20artistEl.textContent.trim()%3B%20var%20diffs%20%3D%20%5B'easy'%2C%20'normal'%2C%20'hyper'%2C%20'ex'%5D%3B%20for%20(var%20di%20%3D%200%3B%20di%20%3C%20diffs.length%3B%20di%2B%2B)%20%7B%20var%20diffName%20%3D%20diffs%5Bdi%5D%3B%20var%20tbl%20%3D%20doc.querySelector('div.dif_tbl%23'%20%2B%20diffName)%3B%20if%20(!tbl)%20continue%3B%20var%20chartDetail%20%3D%20%7B%7D%3B%20var%20medalDiv%20%3D%20tbl.querySelector('div.detail_medal')%3B%20if%20(medalDiv)%20%7B%20var%20bgStyle%20%3D%20medalDiv.getAttribute('style')%20%7C%7C%20''%3B%20var%20bgMatch%20%3D%20bgStyle.match(%2Fmeda_big_(%5Ba-z_%5D%2B)%5C.png%2F)%3B%20if%20(bgMatch)%20%7B%20var%20medalKey%20%3D%20'meda_'%20%2B%20bgMatch%5B1%5D%3B%20chartDetail.medal%20%3D%20MEDAL_MAP%5BmedalKey%5D%20%7C%7C%20medalKey%3B%20%7D%20var%20rankImg%20%3D%20medalDiv.querySelector('img')%3B%20if%20(rankImg)%20%7B%20var%20rankMatch%20%3D%20rankImg.getAttribute('src').match(%2Frank_big_(%5Ba-z0-9_%5D%2B)%5C.png%2F)%3B%20if%20(rankMatch)%20%7B%20var%20rankKey%20%3D%20'rank_'%20%2B%20rankMatch%5B1%5D%3B%20chartDetail.rank%20%3D%20RANK_MAP%5BrankKey%5D%20!%3D%3D%20undefined%20%3F%20RANK_MAP%5BrankKey%5D%20%3A%20rankKey%3B%20%7D%20%7D%20%7D%20var%20rows%20%3D%20tbl.querySelectorAll('table.dif_score_tbl%20tr')%3B%20for%20(var%20ri%20%3D%200%3B%20ri%20%3C%20rows.length%3B%20ri%2B%2B)%20%7B%20var%20cells%20%3D%20rows%5Bri%5D.querySelectorAll('td')%3B%20if%20(cells.length%20%3C%202)%20continue%3B%20var%20label%20%3D%20cells%5B0%5D.textContent.trim()%3B%20var%20val%20%3D%20cells%5B1%5D.textContent.trim()%3B%20if%20(val%20%3D%3D%3D%20'-'%20%7C%7C%20val%20%3D%3D%3D%20'')%20continue%3B%20var%20numVal%20%3D%20parseInt(val.replace(%2F%5B%5E0-9%5D%2Fg%2C%20''))%3B%20if%20(rows%5Bri%5D.classList.contains('score')%20%26%26%20!label)%20%7B%20chartDetail.score%20%3D%20isNaN(numVal)%20%3F%20null%20%3A%20numVal%3B%20%7D%20else%20if%20(label%20%3D%3D%3D%20'COOL')%20%7B%20chartDetail.cool%20%3D%20isNaN(numVal)%20%3F%20null%20%3A%20numVal%3B%20%7D%20else%20if%20(label%20%3D%3D%3D%20'GREAT')%20%7B%20chartDetail.great%20%3D%20isNaN(numVal)%20%3F%20null%20%3A%20numVal%3B%20%7D%20else%20if%20(label%20%3D%3D%3D%20'GOOD')%20%7B%20chartDetail.good%20%3D%20isNaN(numVal)%20%3F%20null%20%3A%20numVal%3B%20%7D%20else%20if%20(label%20%3D%3D%3D%20'BAD')%20%7B%20chartDetail.bad%20%3D%20isNaN(numVal)%20%3F%20null%20%3A%20numVal%3B%20%7D%20else%20if%20(label.indexOf('%E3%83%8F%E3%82%A4%E3%83%A9%E3%82%A4%E3%83%88')%20%3E%3D%200)%20%7B%20chartDetail.highlight%20%3D%20isNaN(numVal)%20%3F%20null%20%3A%20numVal%3B%20%7D%20else%20if%20(label.indexOf('%E3%83%97%E3%83%AC%E3%83%BC%E5%9B%9E%E6%95%B0')%20%3E%3D%200)%20%7B%20chartDetail.playCount%20%3D%20isNaN(numVal)%20%3F%20null%20%3A%20numVal%3B%20%7D%20else%20if%20(label.indexOf('%E3%82%AF%E3%83%AA%E3%82%A2%E5%9B%9E%E6%95%B0')%20%3E%3D%200)%20%7B%20chartDetail.clearCount%20%3D%20isNaN(numVal)%20%3F%20null%20%3A%20numVal%3B%20%7D%20else%20if%20(label%20%3D%3D%3D%20'FULL%20COMBO%E5%9B%9E%E6%95%B0')%20%7B%20chartDetail.fcCount%20%3D%20isNaN(numVal)%20%3F%20null%20%3A%20numVal%3B%20%7D%20else%20if%20(label%20%3D%3D%3D%20'PERFECT%E5%9B%9E%E6%95%B0')%20%7B%20chartDetail.perfectCount%20%3D%20isNaN(numVal)%20%3F%20null%20%3A%20numVal%3B%20%7D%20%7D%20var%20optEl%20%3D%20tbl.querySelector('div.item_st')%3B%20if%20(optEl)%20%7B%20var%20optText%20%3D%20optEl.textContent.trim()%3B%20if%20(optText%20%26%26%20optText.indexOf('%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E6%9C%AA%E4%BF%9D%E5%AD%98')%20%3C%200)%20%7B%20chartDetail.options%20%3D%20optText.replace(%2F%5Cs%7B2%2C%7D%2Fg%2C%20'%20').trim()%3B%20%7D%20%7D%20detail%5BdiffName%5D%20%3D%20chartDetail%3B%20%7D%20return%20detail%3B%20%7D%20function%20getTotalPages(doc)%20%7B%20var%20lastOption%20%3D%20doc.querySelector('select%23s_page%20option%3Alast-child')%3B%20if%20(lastOption)%20%7B%20return%20parseInt(lastOption.value)%20%2B%201%3B%20%7D%20return%201%3B%20%7D%20function%20mergeEntry(songMap%2C%20entry)%20%7B%20var%20key%20%3D%20entry.detailUrl%20%7C%7C%20(entry.title%20%2B%20'%7C'%20%2B%20entry.genre)%3B%20if%20(!songMap%5Bkey%5D)%20%7B%20songMap%5Bkey%5D%20%3D%20%7B%20title%3A%20entry.title%2C%20genre%3A%20entry.genre%2C%20artist%3A%20entry.artist%2C%20detailUrl%3A%20entry.detailUrl%2C%20charts%3A%20%7B%7D%2C%20%7D%3B%20%7D%20var%20song%20%3D%20songMap%5Bkey%5D%3B%20var%20diff%20%3D%20entry.difficulty%3B%20if%20(!diff)%20return%3B%20if%20(!song.charts%5Bdiff%5D%20%7C%7C%20song.charts%5Bdiff%5D.score%20%3D%3D%3D%200%20%7C%7C%20song.charts%5Bdiff%5D.score%20%3D%3D%3D%20null)%20%7B%20song.charts%5Bdiff%5D%20%3D%20%7B%20level%3A%20entry.level%2C%20score%3A%20entry.score%2C%20medal%3A%20entry.medal%2C%20rank%3A%20entry.rank%2C%20medalImg%3A%20entry.medalImg%2C%20rankImg%3A%20entry.rankImg%2C%20%7D%3B%20%7D%20%7D%20function%20markUpperCharts(scores)%20%7B%20var%20groups%20%3D%20%7B%7D%3B%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20scores.length%3B%20i%2B%2B)%20%7B%20var%20s%20%3D%20scores%5Bi%5D%3B%20var%20key%20%3D%20s.title%20%2B%20'%7C'%20%2B%20s.genre%20%2B%20'%7C'%20%2B%20s.artist%3B%20if%20(!groups%5Bkey%5D)%20groups%5Bkey%5D%20%3D%20%5B%5D%3B%20groups%5Bkey%5D.push(s)%3B%20%7D%20var%20upperCount%20%3D%200%3B%20for%20(var%20k%20in%20groups)%20%7B%20if%20(groups%5Bk%5D.length%20!%3D%3D%202)%20continue%3B%20var%20a%20%3D%20groups%5Bk%5D%5B0%5D%2C%20b%20%3D%20groups%5Bk%5D%5B1%5D%3B%20var%20sumA%20%3D%200%2C%20sumB%20%3D%200%3B%20var%20diffs%20%3D%20%5B'easy'%2C%20'normal'%2C%20'hyper'%2C%20'ex'%5D%3B%20for%20(var%20di%20%3D%200%3B%20di%20%3C%20diffs.length%3B%20di%2B%2B)%20%7B%20var%20d%20%3D%20diffs%5Bdi%5D%3B%20if%20(a.charts%5Bd%5D)%20sumA%20%2B%3D%20a.charts%5Bd%5D.level%20%7C%7C%200%3B%20if%20(b.charts%5Bd%5D)%20sumB%20%2B%3D%20b.charts%5Bd%5D.level%20%7C%7C%200%3B%20%7D%20if%20(sumA%20%3E%20sumB)%20%7B%20a.isUpper%20%3D%20true%3B%20a.title%20%3D%20a.title%20%2B%20'%20%5BUPPER%5D'%3B%20upperCount%2B%2B%3B%20%7D%20else%20if%20(sumB%20%3E%20sumA)%20%7B%20b.isUpper%20%3D%20true%3B%20b.title%20%3D%20b.title%20%2B%20'%20%5BUPPER%5D'%3B%20upperCount%2B%2B%3B%20%7D%20%7D%20if%20(upperCount%20%3E%200)%20%7B%20log('Detected%20'%20%2B%20upperCount%20%2B%20'%20Upper%20charts')%3B%20%7D%20%7D%20async%20function%20dumpHTML()%20%7B%20log('Dumping%20raw%20HTML%20from%20key%20pages...')%3B%20setMsg1('Dumping%20HTML...')%3B%20var%20dump%20%3D%20%7B%7D%3B%20var%20pages%20%3D%20%5B%20%7B%20name%3A%20'status'%2C%20url%3A%20GAME_BASE%20%2B%20'%2Fplaydata%2Findex.html'%20%7D%2C%20%7B%20name%3A%20'mu_lv_1_p0'%2C%20url%3A%20buildMuLvURL(1%2C%200)%20%7D%2C%20%7B%20name%3A%20'mu_lv_30_p0'%2C%20url%3A%20buildMuLvURL(30%2C%200)%20%7D%2C%20%7B%20name%3A%20'mu_lv_43_p0'%2C%20url%3A%20buildMuLvURL(43%2C%200)%20%7D%2C%20%7B%20name%3A%20'mu_lv_50_p0'%2C%20url%3A%20buildMuLvURL(50%2C%200)%20%7D%2C%20%5D%3B%20try%20%7B%20log('Looking%20for%20a%20played%20song%20detail%20link...')%3B%20var%20listHTML%20%3D%20await%20fetchPage(buildMuLvURL(43%2C%200))%3B%20var%20listDoc%20%3D%20parseHTML(listHTML)%3B%20var%20entries%20%3D%20parseMuLvPage(listDoc)%3B%20var%20playedEntry%20%3D%20null%3B%20for%20(var%20ei%20%3D%200%3B%20ei%20%3C%20entries.length%3B%20ei%2B%2B)%20%7B%20if%20(entries%5Bei%5D.score%20%3E%200%20%26%26%20entries%5Bei%5D.detailUrl)%20%7B%20playedEntry%20%3D%20entries%5Bei%5D%3B%20break%3B%20%7D%20%7D%20if%20(playedEntry)%20%7B%20log('Found%20played%20song%3A%20'%20%2B%20playedEntry.title%20%2B%20'%20(score%3D'%20%2B%20playedEntry.score%20%2B%20')')%3B%20pages.push(%7B%20name%3A%20'mu_detail_sample'%2C%20url%3A%20playedEntry.detailUrl%20%7D)%3B%20%7D%20else%20%7B%20var%20firstLink%20%3D%20listDoc.querySelector('ul.mu_list_table%20%3E%20li%3Anth-child(2)%20div.col_music_lv%20a')%3B%20if%20(firstLink)%20%7B%20pages.push(%7B%20name%3A%20'mu_detail_sample'%2C%20url%3A%20firstLink.getAttribute('href')%20%7D)%3B%20%7D%20%7D%20%7D%20catch%20(e)%20%7B%20log('Could%20not%20find%20detail%20link%3A%20'%20%2B%20e.message)%3B%20%7D%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20pages.length%3B%20i%2B%2B)%20%7B%20var%20page%20%3D%20pages%5Bi%5D%3B%20try%20%7B%20log('%3C-%20GET%20'%20%2B%20page.url)%3B%20var%20html%20%3D%20await%20fetchPage(page.url)%3B%20dump%5Bpage.name%5D%20%3D%20html%3B%20log(page.name%20%2B%20'%3A%20'%20%2B%20html.length%20%2B%20'%20bytes')%3B%20%7D%20catch%20(err)%20%7B%20dump%5Bpage.name%5D%20%3D%20'ERROR%3A%20'%20%2B%20err.message%3B%20log(page.name%20%2B%20'%3A%20ERROR%20'%20%2B%20err.message)%3B%20%7D%20await%20delay(400)%3B%20%7D%20var%20blob%20%3D%20new%20Blob(%5BJSON.stringify(dump%2C%20null%2C%202)%5D%2C%20%7B%20type%3A%20'application%2Fjson'%20%7D)%3B%20var%20url%20%3D%20URL.createObjectURL(blob)%3B%20var%20a%20%3D%20document.createElement('a')%3B%20a.href%20%3D%20url%3B%20a.download%20%3D%20'popn_html_dump_v4_'%20%2B%20new%20Date().toISOString().slice(0%2C%2010)%20%2B%20'.json'%3B%20document.body.appendChild(a)%3B%20a.click()%3B%20document.body.removeChild(a)%3B%20URL.revokeObjectURL(url)%3B%20log('HTML%20dump%20saved%3A%20'%20%2B%20a.download)%3B%20setMsg1('HTML%20dump%20complete.%20'%20%2B%20Object.keys(dump).length%20%2B%20'%20pages%20saved.')%3B%20%7D%20function%20requestStop()%20%7B%20stopRequested%20%3D%20true%3B%20setMsg2('Stopping...')%3B%20%7D%20async%20function%20startUpdate(deepMode)%20%7B%20if%20(isRunning)%20return%3B%20isRunning%20%3D%20true%3B%20stopRequested%20%3D%20false%3B%20collectedData.scores%20%3D%20%5B%5D%3B%20setButtonState('running')%3B%20setProgress(0)%3B%20var%20modeLabel%20%3D%20deepMode%20%3F%20'Deep'%20%3A%20'Quick'%3B%20log('Starting%20'%20%2B%20modeLabel%20%2B%20'%20scrape...')%3B%20try%20%7B%20setMsg1('Fetching%20player%20status...')%3B%20log('%3C-%20GET%20'%20%2B%20GAME_BASE%20%2B%20'%2Fplaydata%2Findex.html')%3B%20var%20statusHTML%20%3D%20await%20fetchPage(GAME_BASE%20%2B%20'%2Fplaydata%2Findex.html')%3B%20collectedData.player%20%3D%20parseStatusPage(parseHTML(statusHTML))%3B%20log('Player%3A%20'%20%2B%20(collectedData.player%5B'%E3%83%97%E3%83%AC%E3%83%BC%E3%83%A4%E3%83%BC%E5%90%8D'%5D%20%7C%7C%20'OK'))%3B%20var%20chara%20%3D%20collectedData.player%5B'%E4%BD%BF%E7%94%A8%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%BC'%5D%3B%20if%20(chara%20%26%26%20chara.img)%20%7B%20try%20%7B%20chara.imgData%20%3D%20await%20fetchImageAsDataURL(chara.img)%3B%20log('Character%20avatar%3A%20'%20%2B%20chara.name)%3B%20%7D%20catch%20(e)%20%7B%20log('Could%20not%20fetch%20avatar%3A%20'%20%2B%20e.message)%3B%20%7D%20%7D%20if%20(stopRequested)%20%7B%20finish('Stopped')%3B%20return%3B%20%7D%20var%20songMap%20%3D%20%7B%7D%3B%20for%20(var%20lv%20%3D%201%3B%20lv%20%3C%3D%20MAX_LEVEL%3B%20lv%2B%2B)%20%7B%20if%20(stopRequested)%20%7B%20finish('Stopped%20(lv%20'%20%2B%20lv%20%2B%20')')%3B%20return%3B%20%7D%20setMsg1(modeLabel%20%2B%20'%3A%20Level%20'%20%2B%20lv%20%2B%20'%2F'%20%2B%20MAX_LEVEL)%3B%20setProgress((lv%20-%201)%20%2F%20MAX_LEVEL)%3B%20var%20firstURL%20%3D%20buildMuLvURL(lv%2C%200)%3B%20log('%3C-%20Lv.'%20%2B%20lv%20%2B%20'%20p1')%3B%20var%20firstHTML%20%3D%20await%20fetchPage(firstURL)%3B%20var%20firstDoc%20%3D%20parseHTML(firstHTML)%3B%20var%20totalPages%20%3D%20getTotalPages(firstDoc)%3B%20var%20entries%20%3D%20parseMuLvPage(firstDoc)%3B%20if%20(entries.length%20%3D%3D%3D%200)%20%7B%20log('Lv.'%20%2B%20lv%20%2B%20'%3A%20empty%2C%20skip')%3B%20await%20delay(PAGE_DELAY)%3B%20continue%3B%20%7D%20for%20(var%20e%20%3D%200%3B%20e%20%3C%20entries.length%3B%20e%2B%2B)%20%7B%20mergeEntry(songMap%2C%20entries%5Be%5D)%3B%20%7D%20for%20(var%20page%20%3D%201%3B%20page%20%3C%20totalPages%3B%20page%2B%2B)%20%7B%20if%20(stopRequested)%20%7B%20finish('Stopped')%3B%20return%3B%20%7D%20await%20delay(PAGE_DELAY)%3B%20log('%3C-%20Lv.'%20%2B%20lv%20%2B%20'%20p'%20%2B%20(page%20%2B%201)%20%2B%20'%2F'%20%2B%20totalPages)%3B%20var%20html%20%3D%20await%20fetchPage(buildMuLvURL(lv%2C%20page))%3B%20var%20pageEntries%20%3D%20parseMuLvPage(parseHTML(html))%3B%20for%20(var%20e2%20%3D%200%3B%20e2%20%3C%20pageEntries.length%3B%20e2%2B%2B)%20%7B%20mergeEntry(songMap%2C%20pageEntries%5Be2%5D)%3B%20%7D%20if%20(pageEntries.length%20%3D%3D%3D%200)%20break%3B%20%7D%20var%20currentCount%20%3D%20Object.keys(songMap).length%3B%20setMsg2('Lv.'%20%2B%20lv%20%2B%20'%20done%20%7C%20'%20%2B%20currentCount%20%2B%20'%20unique%20songs')%3B%20log('Lv.'%20%2B%20lv%20%2B%20'%3A%20'%20%2B%20totalPages%20%2B%20'p%2C%20unique%3A%20'%20%2B%20currentCount)%3B%20await%20delay(PAGE_DELAY)%3B%20%7D%20collectedData.scores%20%3D%20Object.values(songMap)%3B%20markUpperCharts(collectedData.scores)%3B%20var%20totalSongs%20%3D%20collectedData.scores.length%3B%20log('Quick%20scrape%20done%3A%20'%20%2B%20totalSongs%20%2B%20'%20unique%20songs')%3B%20if%20(deepMode%20%26%26%20!stopRequested)%20%7B%20setMsg1('Deep%3A%20fetching%20song%20details...')%3B%20var%20detailCount%20%3D%200%3B%20var%20songsWithDetail%20%3D%20collectedData.scores.filter(function(s)%20%7B%20return%20s.detailUrl%3B%20%7D)%3B%20for%20(var%20di%20%3D%200%3B%20di%20%3C%20songsWithDetail.length%3B%20di%2B%2B)%20%7B%20if%20(stopRequested)%20%7B%20finish('Stopped%20(detail%20'%20%2B%20di%20%2B%20')')%3B%20return%3B%20%7D%20var%20song%20%3D%20songsWithDetail%5Bdi%5D%3B%20setMsg2('Detail%20'%20%2B%20(di%20%2B%201)%20%2B%20'%2F'%20%2B%20songsWithDetail.length%20%2B%20'%3A%20'%20%2B%20song.title)%3B%20setProgress(di%20%2F%20songsWithDetail.length)%3B%20try%20%7B%20log('%3C-%20detail%3A%20'%20%2B%20song.title)%3B%20var%20detailHTML%20%3D%20await%20fetchPage(song.detailUrl)%3B%20song.detail%20%3D%20parseDetailPage(parseHTML(detailHTML))%3B%20detailCount%2B%2B%3B%20%7D%20catch%20(err)%20%7B%20log('detail%20err%20('%20%2B%20song.title%20%2B%20')%3A%20'%20%2B%20err.message)%3B%20song.detail%20%3D%20%7B%20error%3A%20err.message%20%7D%3B%20%7D%20await%20delay(DETAIL_DELAY)%3B%20%7D%20log('Deep%20scrape%20done%3A%20'%20%2B%20detailCount%20%2B%20'%20details%20fetched')%3B%20%7D%20finish('Complete!%20'%20%2B%20totalSongs%20%2B%20'%20songs'%20%2B%20(deepMode%20%3F%20'%20(with%20details)'%20%3A%20''))%3B%20%7D%20catch%20(err)%20%7B%20log('ERROR%3A%20'%20%2B%20err.message)%3B%20setMsg1('Error%3A%20'%20%2B%20err.message)%3B%20isRunning%20%3D%20false%3B%20setButtonState('idle')%3B%20%7D%20%7D%20function%20finish(msg)%20%7B%20collectedData.exportedAt%20%3D%20new%20Date().toISOString()%3B%20isRunning%20%3D%20false%3B%20stopRequested%20%3D%20false%3B%20if%20(collectedData.scores.length%20%3E%200)%20%7B%20var%20pc%20%3D%20calcPopClass(collectedData.scores)%3B%20collectedData.popClass%20%3D%20pc%3B%20setMsg1(msg%20%2B%20%22%20%7C%20Pop'n%20Class%3A%20%22%20%2B%20pc.value.toFixed(2)%20%2B%20'%20('%20%2B%20pc.tier%20%2B%20')')%3B%20log(%22Pop'n%20Class%3A%20%22%20%2B%20pc.value.toFixed(2)%20%2B%20'%20('%20%2B%20pc.tier%20%2B%20')%20from%20'%20%2B%20pc.count%20%2B%20'%20scored%20charts')%3B%20%7D%20else%20%7B%20setMsg1(msg)%3B%20%7D%20setMsg2(collectedData.scores.length%20%2B%20'%20songs%20in%20memory')%3B%20setProgress(1)%3B%20setButtonState('done')%3B%20log(msg)%3B%20%7D%20var%20CLASS_TIERS%20%3D%20%5B%20%7B%20min%3A%2091%2C%20name%3A%20'%E7%A5%9E'%2C%20color%3A%20'%23d0203a'%20%7D%2C%20%7B%20min%3A%2079%2C%20name%3A%20'%E4%BB%99%E4%BA%BA'%2C%20color%3A%20'%23c03050'%20%7D%2C%20%7B%20min%3A%2068%2C%20name%3A%20'%E5%B0%86%E8%BB%8D'%2C%20color%3A%20'%23c08020'%20%7D%2C%20%7B%20min%3A%2059%2C%20name%3A%20'%E3%82%A2%E3%82%A4%E3%83%89%E3%83%AB'%2C%20color%3A%20'%23b0a010'%20%7D%2C%20%7B%20min%3A%2046%2C%20name%3A%20'%E5%88%91%E4%BA%8B'%2C%20color%3A%20'%23209040'%20%7D%2C%20%7B%20min%3A%2034%2C%20name%3A%20'%E7%95%AA%E9%95%B7'%2C%20color%3A%20'%231a9080'%20%7D%2C%20%7B%20min%3A%2021%2C%20name%3A%20'%E5%B0%8F%E5%AD%A6%E7%94%9F'%2C%20color%3A%20'%232e70c0'%20%7D%2C%20%7B%20min%3A%200%2C%20name%3A%20'%E3%81%AB%E3%82%83%E3%82%93%E3%81%93'%2C%20color%3A%20'%23907860'%20%7D%2C%20%5D%3B%20function%20popClassMedalBonus(medal)%20%7B%20if%20(!medal)%20return%200%3B%20if%20(medal%20%3D%3D%3D%20'easy_clear'%20%7C%7C%20medal.indexOf('normal_clear')%20%3D%3D%3D%200)%20return%203000%3B%20if%20(medal.indexOf('full_combo')%20%3D%3D%3D%200%20%7C%7C%20medal%20%3D%3D%3D%20'perfect')%20return%205000%3B%20return%200%3B%20%7D%20function%20calcChartClassPts(lv%2C%20score%2C%20medal)%20%7B%20if%20(!score%20%7C%7C%20score%20%3C%2050000)%20return%200%3B%20var%20raw%20%3D%20(10000%20*%20lv%20%2B%20score%20-%2050000%20%2B%20popClassMedalBonus(medal))%20%2F%205440%3B%20return%20Math.min(Math.floor(raw%20*%20100)%20%2F%20100%2C%20100)%3B%20%7D%20function%20calcPopClass(scores)%20%7B%20var%20pts%20%3D%20%5B%5D%3B%20for%20(var%20si%20%3D%200%3B%20si%20%3C%20scores.length%3B%20si%2B%2B)%20%7B%20var%20song%20%3D%20scores%5Bsi%5D%3B%20var%20charts%20%3D%20song.charts%20%7C%7C%20%7B%7D%3B%20var%20diffs%20%3D%20%5B'easy'%2C%20'normal'%2C%20'hyper'%2C%20'ex'%5D%3B%20for%20(var%20di%20%3D%200%3B%20di%20%3C%20diffs.length%3B%20di%2B%2B)%20%7B%20var%20c%20%3D%20charts%5Bdiffs%5Bdi%5D%5D%3B%20if%20(!c)%20continue%3B%20var%20p%20%3D%20calcChartClassPts(c.level%20%7C%7C%200%2C%20c.score%20%7C%7C%200%2C%20c.medal)%3B%20if%20(p%20%3E%200)%20pts.push(p)%3B%20%7D%20%7D%20pts.sort(function(a%2C%20b)%20%7B%20return%20b%20-%20a%3B%20%7D)%3B%20var%20top50%20%3D%20pts.slice(0%2C%2050)%3B%20if%20(top50.length%20%3D%3D%3D%200)%20return%20%7B%20value%3A%200%2C%20tier%3A%20'%E3%81%AB%E3%82%83%E3%82%93%E3%81%93'%2C%20count%3A%200%20%7D%3B%20var%20avg%20%3D%200%3B%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20top50.length%3B%20i%2B%2B)%20avg%20%2B%3D%20top50%5Bi%5D%3B%20avg%20%3D%20Math.floor((avg%20%2F%20Math.min(top50.length%2C%2050))%20*%20100)%20%2F%20100%3B%20var%20tier%20%3D%20'%E3%81%AB%E3%82%83%E3%82%93%E3%81%93'%3B%20for%20(var%20ti%20%3D%200%3B%20ti%20%3C%20CLASS_TIERS.length%3B%20ti%2B%2B)%20%7B%20if%20(avg%20%3E%3D%20CLASS_TIERS%5Bti%5D.min)%20%7B%20tier%20%3D%20CLASS_TIERS%5Bti%5D.name%3B%20break%3B%20%7D%20%7D%20return%20%7B%20value%3A%20avg%2C%20tier%3A%20tier%2C%20count%3A%20pts.length%20%7D%3B%20%7D%20function%20exportJSON()%20%7B%20var%20exportData%20%3D%20%7B%20player%3A%20collectedData.player%2C%20scores%3A%20collectedData.scores%2C%20exportedAt%3A%20collectedData.exportedAt%2C%20%7D%3B%20var%20json%20%3D%20JSON.stringify(exportData%2C%20null%2C%202)%3B%20var%20blob%20%3D%20new%20Blob(%5Bjson%5D%2C%20%7B%20type%3A%20'application%2Fjson'%20%7D)%3B%20var%20url%20%3D%20URL.createObjectURL(blob)%3B%20var%20a%20%3D%20document.createElement('a')%3B%20a.href%20%3D%20url%3B%20a.download%20%3D%20'popn_scores_'%20%2B%20new%20Date().toISOString().slice(0%2C%2010)%20%2B%20'.json'%3B%20document.body.appendChild(a)%3B%20a.click()%3B%20document.body.removeChild(a)%3B%20URL.revokeObjectURL(url)%3B%20log('Exported%20JSON%3A%20'%20%2B%20a.download)%3B%20%7D%20var%20MEDAL_LABELS%20%3D%20%7B%20'no_play'%3A%20'No%20Play'%2C%20'easy_clear'%3A%20'%5Cu7dd1%5Cu2b24'%2C%20'failed_1'%3A%20'%5Cu7070%5Cu2b24'%2C%20'failed_2'%3A%20'%5Cu7070%5Cu25c6'%2C%20'failed_3'%3A%20'%5Cu7070%5Cu2605'%2C%20'normal_clear'%3A%20'%5Cu9285%5Cu2b24'%2C%20'normal_clear_in_20_bad'%3A%20'%5Cu9285%5Cu25c6'%2C%20'normal_clear_in_5_bad'%3A%20'%5Cu9285%5Cu2605'%2C%20'full_combo'%3A%20'%5Cu9280%5Cu2b24'%2C%20'full_combo_in_20_good'%3A%20'%5Cu9280%5Cu25c6'%2C%20'full_combo_in_5_good'%3A%20'%5Cu9280%5Cu2605'%2C%20'perfect'%3A%20'%5Cu91d1%5Cu2605'%20%7D%3B%20var%20MEDAL_COLORS%20%3D%20%7B%20'no_play'%3A%20'%23bbb'%2C%20'easy_clear'%3A%20'%232ea868'%2C%20'failed_1'%3A%20'%23999'%2C%20'failed_2'%3A%20'%23999'%2C%20'failed_3'%3A%20'%23999'%2C%20'normal_clear'%3A%20'%23b87333'%2C%20'normal_clear_in_20_bad'%3A%20'%23b87333'%2C%20'normal_clear_in_5_bad'%3A%20'%23b87333'%2C%20'full_combo'%3A%20'%23888'%2C%20'full_combo_in_20_good'%3A%20'%23888'%2C%20'full_combo_in_5_good'%3A%20'%23888'%2C%20'perfect'%3A%20'%23d4a017'%20%7D%3B%20var%20DIFF_COLORS%20%3D%20%7B%20easy%3A%20'%231ea868'%2C%20normal%3A%20'%232e7ed6'%2C%20hyper%3A%20'%23d08a10'%2C%20ex%3A%20'%23d04030'%20%7D%3B%20function%20exportClassImage()%20%7B%20if%20(collectedData.scores.length%20%3D%3D%3D%200)%20return%3B%20var%20chartPts%20%3D%20%5B%5D%3B%20for%20(var%20si%20%3D%200%3B%20si%20%3C%20collectedData.scores.length%3B%20si%2B%2B)%20%7B%20var%20song%20%3D%20collectedData.scores%5Bsi%5D%3B%20var%20charts%20%3D%20song.charts%20%7C%7C%20%7B%7D%3B%20var%20diffs%20%3D%20%5B'easy'%2C%20'normal'%2C%20'hyper'%2C%20'ex'%5D%3B%20for%20(var%20di%20%3D%200%3B%20di%20%3C%20diffs.length%3B%20di%2B%2B)%20%7B%20var%20c%20%3D%20charts%5Bdiffs%5Bdi%5D%5D%3B%20if%20(!c)%20continue%3B%20var%20p%20%3D%20calcChartClassPts(c.level%20%7C%7C%200%2C%20c.score%20%7C%7C%200%2C%20c.medal)%3B%20if%20(p%20%3E%200)%20chartPts.push(%7B%20title%3A%20song.title%2C%20genre%3A%20song.genre%2C%20diff%3A%20diffs%5Bdi%5D%2C%20level%3A%20c.level%20%7C%7C%200%2C%20score%3A%20c.score%20%7C%7C%200%2C%20medal%3A%20c.medal%2C%20rank%3A%20c.rank%2C%20pts%3A%20p%20%7D)%3B%20%7D%20%7D%20chartPts.sort(function(a%2C%20b)%20%7B%20return%20b.pts%20-%20a.pts%3B%20%7D)%3B%20var%20top50%20%3D%20chartPts.slice(0%2C%2050)%3B%20var%20rowH%20%3D%2028%3B%20var%20headerH%20%3D%2040%3B%20var%20titleH%20%3D%2060%3B%20var%20footerH%20%3D%2030%3B%20var%20colGap%20%3D%2016%3B%20var%20cols%20%3D%20%5B34%2C%20250%2C%2054%2C%2034%2C%2060%2C%2050%2C%2060%5D%3B%20var%20tableW%20%3D%200%3B%20for%20(var%20ci%20%3D%200%3B%20ci%20%3C%20cols.length%3B%20ci%2B%2B)%20tableW%20%2B%3D%20cols%5Bci%5D%3B%20tableW%20%2B%3D%2016%3B%20var%20rowCount%20%3D%20Math.min(top50.length%2C%2025)%3B%20var%20hasTwoCols%20%3D%20top50.length%20%3E%2025%3B%20var%20totalW%20%3D%20hasTwoCols%20%3F%20(tableW%20*%202%20%2B%20colGap)%20%3A%20tableW%3B%20var%20totalH%20%3D%20titleH%20%2B%20headerH%20%2B%20(rowCount%20*%20rowH)%20%2B%20footerH%3B%20var%20canvas%20%3D%20document.createElement('canvas')%3B%20canvas.width%20%3D%20totalW%3B%20canvas.height%20%3D%20totalH%3B%20var%20ctx%20%3D%20canvas.getContext('2d')%3B%20ctx.fillStyle%20%3D%20'%23fef6f0'%3B%20ctx.fillRect(0%2C%200%2C%20totalW%2C%20totalH)%3B%20var%20pc%20%3D%20collectedData.popClass%20%7C%7C%20%7B%20value%3A%200%2C%20tier%3A%20'%E3%81%AB%E3%82%83%E3%82%93%E3%81%93'%20%7D%3B%20var%20tierColor%20%3D%20'%23907860'%3B%20for%20(var%20ti2%20%3D%200%3B%20ti2%20%3C%20CLASS_TIERS.length%3B%20ti2%2B%2B)%20%7B%20if%20(pc.value%20%3E%3D%20CLASS_TIERS%5Bti2%5D.min)%20%7B%20tierColor%20%3D%20CLASS_TIERS%5Bti2%5D.color%3B%20break%3B%20%7D%20%7D%20ctx.fillStyle%20%3D%20tierColor%3B%20ctx.font%20%3D%20'bold%2024px%20Segoe%20UI%2C%20sans-serif'%3B%20ctx.fillText(%22Pop'n%20Score%20Tool%22%2C%2010%2C%2030)%3B%20var%20titleRight%20%3D%2010%20%2B%20ctx.measureText(%22Pop'n%20Score%20Tool%22).width%20%2B%2016%3B%20var%20chara%20%3D%20collectedData.player%20%26%26%20collectedData.player%5B'%5Cu4f7f%5Cu7528%5Cu30ad%5Cu30e3%5Cu30e9%5Cu30af%5Cu30bf%5Cu30fc'%5D%3B%20var%20avatarSize%20%3D%2036%3B%20var%20hasAvatar%20%3D%20chara%20%26%26%20chara.imgData%3B%20var%20textLeft%20%3D%20hasAvatar%20%3F%20titleRight%20%2B%20avatarSize%20%2B%208%20%3A%20titleRight%3B%20ctx.fillStyle%20%3D%20'%233d2b1f'%3B%20ctx.font%20%3D%20'16px%20Segoe%20UI%2C%20sans-serif'%3B%20var%20playerName%20%3D%20(collectedData.player%20%26%26%20collectedData.player%5B'%5Cu30d7%5Cu30ec%5Cu30fc%5Cu30e4%5Cu30fc%5Cu540d'%5D)%20%7C%7C%20''%3B%20ctx.fillText(playerName%20%2B%20%22%20Pop'n%20Class%3A%20%22%20%2B%20pc.value.toFixed(2)%20%2B%20'%20('%20%2B%20pc.tier%20%2B%20')'%2C%20textLeft%2C%2030)%3B%20ctx.fillStyle%20%3D%20'%23907860'%3B%20ctx.font%20%3D%20'11px%20Segoe%20UI%2C%20sans-serif'%3B%20ctx.fillText('Top%2050%20Charts'%2C%20textLeft%2C%2048)%3B%20var%20headers%20%3D%20%5B'%23'%2C%20'Genre%20%2F%20Title'%2C%20'Diff'%2C%20'Lv'%2C%20'Score'%2C%20'Medal'%2C%20'Pts'%5D%3B%20function%20drawTable(startIdx%2C%20endIdx%2C%20offsetX)%20%7B%20var%20y%20%3D%20titleH%3B%20ctx.fillStyle%20%3D%20'%23ffe0d0'%3B%20ctx.fillRect(offsetX%2C%20y%2C%20tableW%2C%20headerH)%3B%20ctx.fillStyle%20%3D%20'%23907860'%3B%20ctx.font%20%3D%20'bold%2012px%20Segoe%20UI%2C%20sans-serif'%3B%20var%20x%20%3D%20offsetX%20%2B%208%3B%20for%20(var%20hi%20%3D%200%3B%20hi%20%3C%20headers.length%3B%20hi%2B%2B)%20%7B%20ctx.fillText(headers%5Bhi%5D%2C%20x%2C%20y%20%2B%2026)%3B%20x%20%2B%3D%20cols%5Bhi%5D%3B%20%7D%20y%20%2B%3D%20headerH%3B%20ctx.font%20%3D%20'12px%20Segoe%20UI%2C%20sans-serif'%3B%20for%20(var%20ri%20%3D%20startIdx%3B%20ri%20%3C%20endIdx%3B%20ri%2B%2B)%20%7B%20var%20c%20%3D%20top50%5Bri%5D%3B%20if%20((ri%20-%20startIdx)%20%25%202%20%3D%3D%3D%200)%20%7B%20ctx.fillStyle%20%3D%20'%23fff0ea'%3B%20ctx.fillRect(offsetX%2C%20y%2C%20tableW%2C%20rowH)%3B%20%7D%20x%20%3D%20offsetX%20%2B%208%3B%20ctx.fillStyle%20%3D%20'%23907860'%3B%20ctx.fillText((ri%20%2B%201).toString()%2C%20x%2C%20y%20%2B%2019)%3B%20x%20%2B%3D%20cols%5B0%5D%3B%20ctx.fillStyle%20%3D%20'%233d2b1f'%3B%20var%20baseTitle%20%3D%20c.title.replace(%2F%20%5C%5BUPPER%5C%5D%24%2F%2C%20'')%3B%20var%20t%20%3D%20(!c.genre%20%7C%7C%20c.genre%20%3D%3D%3D%20baseTitle)%20%3F%20c.title%20%3A%20(c.genre%20%2B%20'%20%2F%20'%20%2B%20c.title)%3B%20if%20(t.length%20%3E%2028)%20t%20%3D%20t.substring(0%2C%2026)%20%2B%20'...'%3B%20ctx.fillText(t%2C%20x%2C%20y%20%2B%2019)%3B%20x%20%2B%3D%20cols%5B1%5D%3B%20ctx.fillStyle%20%3D%20DIFF_COLORS%5Bc.diff%5D%20%7C%7C%20'%233d2b1f'%3B%20ctx.fillText(c.diff.toUpperCase()%2C%20x%2C%20y%20%2B%2019)%3B%20x%20%2B%3D%20cols%5B2%5D%3B%20ctx.fillStyle%20%3D%20'%233d2b1f'%3B%20ctx.fillText(c.level.toString()%2C%20x%2C%20y%20%2B%2019)%3B%20x%20%2B%3D%20cols%5B3%5D%3B%20ctx.fillText(c.score%20%3E%200%20%3F%20c.score.toString()%20%3A%20'-'%2C%20x%2C%20y%20%2B%2019)%3B%20x%20%2B%3D%20cols%5B4%5D%3B%20ctx.fillStyle%20%3D%20MEDAL_COLORS%5Bc.medal%5D%20%7C%7C%20'%23907860'%3B%20ctx.fillText(MEDAL_LABELS%5Bc.medal%5D%20%7C%7C%20c.medal%20%7C%7C%20'-'%2C%20x%2C%20y%20%2B%2019)%3B%20x%20%2B%3D%20cols%5B5%5D%3B%20ctx.fillStyle%20%3D%20'%23e94560'%3B%20ctx.fillText(c.pts.toFixed(2)%2C%20x%2C%20y%20%2B%2019)%3B%20y%20%2B%3D%20rowH%3B%20%7D%20%7D%20drawTable(0%2C%20Math.min(top50.length%2C%2025)%2C%200)%3B%20if%20(hasTwoCols)%20%7B%20drawTable(25%2C%20top50.length%2C%20tableW%20%2B%20colGap)%3B%20%7D%20ctx.fillStyle%20%3D%20'%23907860'%3B%20ctx.font%20%3D%20'10px%20Segoe%20UI%2C%20sans-serif'%3B%20ctx.fillText(%22Generated%20by%20Pop'n%20Score%20Tool%20%7C%20%22%20%2B%20(collectedData.exportedAt%20%7C%7C%20'')%2C%2010%2C%20totalH%20-%2010)%3B%20function%20doDownload()%20%7B%20var%20link%20%3D%20document.createElement('a')%3B%20link.download%20%3D%20'popn_class_top50.png'%3B%20link.href%20%3D%20canvas.toDataURL('image%2Fpng')%3B%20document.body.appendChild(link)%3B%20link.click()%3B%20document.body.removeChild(link)%3B%20log(%22Exported%20Pop'n%20Class%20image%22)%3B%20%7D%20if%20(hasAvatar)%20%7B%20var%20avatarImg%20%3D%20new%20Image()%3B%20avatarImg.onload%20%3D%20function()%20%7B%20ctx.drawImage(avatarImg%2C%20titleRight%2C%2012%2C%20avatarSize%2C%20avatarSize)%3B%20doDownload()%3B%20%7D%3B%20avatarImg.onerror%20%3D%20doDownload%3B%20avatarImg.src%20%3D%20chara.imgData%3B%20%7D%20else%20%7B%20doDownload()%3B%20%7D%20%7D%20var%20VIEWER_TEMPLATE%20%3D%20'%3C!DOCTYPE%20html%3E%5Cn%3Chtml%20lang%3D%22ja%22%3E%5Cn%3Chead%3E%5Cn%3Cmeta%20charset%3D%22UTF-8%22%3E%5Cn%3Cmeta%20name%3D%22viewport%22%20content%3D%22width%3Ddevice-width%2C%20initial-scale%3D1.0%22%3E%5Cn%3Ctitle%3EPop%5C'n%20Score%20Tool%3C%2Ftitle%3E%5Cn%3Cstyle%3E%5Cn%3Aroot%20%7B%5Cn--bg%3A%20%23fef6f0%3B%5Cn--bg2%3A%20%23fff0ea%3B%5Cn--bg3%3A%20%23ffe0d0%3B%5Cn--border%3A%20%23f0c8b0%3B%5Cn--text%3A%20%233d2b1f%3B%5Cn--text2%3A%20%23907860%3B%5Cn--accent%3A%20%23e94560%3B%5Cn--accent2%3A%20%232ecc71%3B%5Cn--blue%3A%20%234a8fe7%3B%5Cn--purple%3A%20%23b06ce0%3B%5Cn--yellow%3A%20%23e0900a%3B%5Cn--easy%3A%20%231ea868%3B%5Cn--normal%3A%20%232e7ed6%3B%5Cn--hyper%3A%20%23d08a10%3B%5Cn--ex%3A%20%23d04030%3B%5Cn%7D%5Cn*%20%7B%20margin%3A%200%3B%20padding%3A%200%3B%20box-sizing%3A%20border-box%3B%20%7D%5Cnbody%20%7B%5Cnfont-family%3A%20%5C'Segoe%20UI%5C'%2C%20%5C'Noto%20Sans%20JP%5C'%2C%20sans-serif%3B%5Cnbackground%3A%20var(--bg)%3B%5Cncolor%3A%20var(--text)%3B%5Cnline-height%3A%201.5%3B%5Cn%7D%5Cn.container%20%7B%20max-width%3A%201200px%3B%20margin%3A%200%20auto%3B%20padding%3A%2020px%3B%20%7D%5Cnh1%20%7B%20color%3A%20var(--accent)%3B%20font-size%3A%2028px%3B%20%7D%5Cnh2%20%7B%20color%3A%20var(--text)%3B%20font-size%3A%2018px%3B%20margin%3A%200%200%2012px%200%3B%20border-bottom%3A%201px%20solid%20var(--border)%3B%20padding-bottom%3A%206px%3B%20%7D%5Cn%2F*%20Header%20%2F%20Player%20info%20*%2F%5Cn.header%20%7B%20display%3A%20flex%3B%20align-items%3A%20center%3B%20gap%3A%2020px%3B%20margin-bottom%3A%2024px%3B%20flex-wrap%3A%20wrap%3B%20%7D%5Cn.header%20h1%20%7B%20flex-shrink%3A%200%3B%20%7D%5Cn.player-info%20%7B%20display%3A%20flex%3B%20gap%3A%2012px%3B%20align-items%3A%20center%3B%20flex-wrap%3A%20wrap%3B%20%7D%5Cn.player-info%20.avatar%20%7B%5Cnwidth%3A%2048px%3B%20height%3A%2048px%3B%20border-radius%3A%208px%3B%20border%3A%202px%20solid%20var(--border)%3B%5Cnobject-fit%3A%20cover%3B%20flex-shrink%3A%200%3B%5Cn%7D%5Cn.player-info%20.tag%20%7B%5Cnbackground%3A%20var(--bg3)%3B%20border-radius%3A%206px%3B%20padding%3A%204px%2012px%3B%5Cnfont-size%3A%2013px%3B%20color%3A%20var(--text2)%3B%5Cn%7D%5Cn.player-info%20.tag%20b%20%7B%20color%3A%20var(--text)%3B%20%7D%5Cn%2F*%20Tabs%20*%2F%5Cn.tabs%20%7B%20display%3A%20flex%3B%20gap%3A%204px%3B%20margin-bottom%3A%2020px%3B%20flex-wrap%3A%20wrap%3B%20%7D%5Cn.tab%20%7B%5Cnpadding%3A%208px%2020px%3B%20border%3A%20none%3B%20border-radius%3A%206px%206px%200%200%3B%5Cnbackground%3A%20var(--bg2)%3B%20color%3A%20var(--text2)%3B%20cursor%3A%20pointer%3B%5Cnfont-size%3A%2014px%3B%20font-family%3A%20inherit%3B%5Cn%7D%5Cn.tab%3Ahover%20%7B%20color%3A%20var(--text)%3B%20%7D%5Cn.tab.active%20%7B%20background%3A%20var(--bg3)%3B%20color%3A%20var(--accent)%3B%20border-bottom%3A%202px%20solid%20var(--accent)%3B%20%7D%5Cn.tab-panel%20%7B%20display%3A%20none%3B%20%7D%5Cn.tab-panel.active%20%7B%20display%3A%20block%3B%20%7D%5Cn%2F*%20Pop%20Class%20card%20*%2F%5Cn.popclass-card%20%7B%5Cnbackground%3A%20linear-gradient(135deg%2C%20var(--bg2)%2C%20var(--bg3))%3B%5Cnborder%3A%201px%20solid%20var(--border)%3B%20border-radius%3A%2012px%3B%5Cnpadding%3A%2024px%3B%20margin-bottom%3A%2024px%3B%20text-align%3A%20center%3B%5Cn%7D%5Cn.popclass-value%20%7B%20font-size%3A%2064px%3B%20font-weight%3A%20bold%3B%20color%3A%20var(--accent)%3B%20line-height%3A%201.1%3B%20%7D%5Cn.popclass-tier%20%7B%20font-size%3A%2024px%3B%20color%3A%20var(--yellow)%3B%20margin%3A%204px%200%3B%20%7D%5Cn.popclass-bar-wrap%20%7B%5Cnwidth%3A%20300px%3B%20max-width%3A%20100%25%3B%20height%3A%208px%3B%20background%3A%20var(--bg)%3B%5Cnborder-radius%3A%204px%3B%20margin%3A%2012px%20auto%3B%20overflow%3A%20hidden%3B%5Cn%7D%5Cn.popclass-bar%20%7B%20height%3A%20100%25%3B%20background%3A%20var(--accent)%3B%20border-radius%3A%204px%3B%20transition%3A%20width%200.5s%3B%20%7D%5Cn.popclass-sub%20%7B%20font-size%3A%2013px%3B%20color%3A%20var(--text2)%3B%20%7D%5Cn%2F*%20Top%2050%20two-column%20*%2F%5Cn.top50-section%20%7B%20margin-bottom%3A%2024px%3B%20%7D%5Cn.top50-flex%20%7B%20display%3A%20flex%3B%20gap%3A%2020px%3B%20flex-wrap%3A%20wrap%3B%20%7D%5Cn.top50-flex%20%3E%20div%20%7B%20flex%3A%201%3B%20min-width%3A%20400px%3B%20%7D%5Cn.export-btn%20%7B%5Cnpadding%3A%206px%2016px%3B%20border%3A%20none%3B%20border-radius%3A%206px%3B%5Cnbackground%3A%20var(--accent2)%3B%20color%3A%20%23fff%3B%20cursor%3A%20pointer%3B%5Cnfont-size%3A%2013px%3B%20font-family%3A%20inherit%3B%20margin-bottom%3A%2012px%3B%5Cn%7D%5Cn.export-btn%3Ahover%20%7B%20opacity%3A%200.8%3B%20%7D%5Cn%2F*%20Tables%20*%2F%5Cntable.data-table%20%7B%5Cnwidth%3A%20100%25%3B%20border-collapse%3A%20collapse%3B%20font-size%3A%2013px%3B%5Cnbackground%3A%20var(--bg2)%3B%20border-radius%3A%208px%3B%20overflow%3A%20hidden%3B%5Cn%7D%5Cntable.data-table%20th%20%7B%5Cnbackground%3A%20var(--bg3)%3B%20padding%3A%208px%2010px%3B%20text-align%3A%20left%3B%5Cnfont-weight%3A%20600%3B%20color%3A%20var(--text2)%3B%20cursor%3A%20pointer%3B%20user-select%3A%20none%3B%5Cnwhite-space%3A%20nowrap%3B%20border-bottom%3A%201px%20solid%20var(--border)%3B%5Cn%7D%5Cntable.data-table%20th%3Ahover%20%7B%20color%3A%20var(--text)%3B%20%7D%5Cntable.data-table%20th%20.sort-arrow%20%7B%20font-size%3A%2010px%3B%20margin-left%3A%204px%3B%20%7D%5Cntable.data-table%20td%20%7B%5Cnpadding%3A%206px%2010px%3B%20border-bottom%3A%201px%20solid%20var(--border)%3B%5Cnwhite-space%3A%20nowrap%3B%20overflow%3A%20hidden%3B%20text-overflow%3A%20ellipsis%3B%20max-width%3A%20280px%3B%5Cn%7D%5Cntable.data-table%20tr%3Ahover%20td%20%7B%20background%3A%20var(--bg3)%3B%20%7D%5Cn.diff-easy%20%7B%20color%3A%20var(--easy)%3B%20%7D%5Cn.diff-normal%20%7B%20color%3A%20var(--normal)%3B%20%7D%5Cn.diff-hyper%20%7B%20color%3A%20var(--hyper)%3B%20%7D%5Cn.diff-ex%20%7B%20color%3A%20var(--ex)%3B%20%7D%5Cn.medal-cell%20%7B%20font-size%3A%2011px%3B%20%7D%5Cn.score-cell%20%7B%20font-family%3A%20%5C'Consolas%5C'%2C%20monospace%3B%20%7D%5Cn%2F*%20Filters%20*%2F%5Cn.filters%20%7B%5Cndisplay%3A%20flex%3B%20gap%3A%2016px%3B%20align-items%3A%20flex-start%3B%20margin-bottom%3A%2012px%3B%5Cnflex-wrap%3A%20wrap%3B%20font-size%3A%2013px%3B%5Cn%7D%5Cn.filter-group%20%7B%20margin-bottom%3A%208px%3B%20%7D%5Cn.filter-group%20.filter-label%20%7B%20color%3A%20var(--text2)%3B%20margin-bottom%3A%204px%3B%20font-weight%3A%20600%3B%20%7D%5Cn.filter-group%20.filter-opts%20%7B%5Cndisplay%3A%20flex%3B%20gap%3A%204px%3B%20flex-wrap%3A%20wrap%3B%20align-items%3A%20center%3B%5Cn%7D%5Cn.filter-group%20.filter-opts%20label%20%7B%5Cndisplay%3A%20flex%3B%20align-items%3A%20center%3B%20gap%3A%202px%3B%5Cnbackground%3A%20var(--bg3)%3B%20border-radius%3A%204px%3B%20padding%3A%202px%208px%3B%5Cncursor%3A%20pointer%3B%20font-size%3A%2012px%3B%20color%3A%20var(--text)%3B%5Cnborder%3A%201px%20solid%20var(--border)%3B%20user-select%3A%20none%3B%5Cn%7D%5Cn.filter-group%20.filter-opts%20label%3Ahover%20%7B%20border-color%3A%20var(--text2)%3B%20%7D%5Cn.filter-group%20.filter-opts%20label.checked%20%7B%20border-color%3A%20var(--accent)%3B%20background%3A%20%23fde8e8%3B%20%7D%5Cn.filter-group%20.filter-opts%20input%5Btype%3D%22checkbox%22%5D%20%7B%20display%3A%20none%3B%20%7D%5Cn.filter-group%20.toggle-link%20%7B%5Cnfont-size%3A%2011px%3B%20color%3A%20var(--blue)%3B%20cursor%3A%20pointer%3B%20margin-left%3A%204px%3B%5Cntext-decoration%3A%20underline%3B%5Cn%7D%5Cn.filter-search%20%7B%5Cnpadding%3A%204px%208px%3B%20border%3A%201px%20solid%20var(--border)%3B%20border-radius%3A%204px%3B%5Cnbackground%3A%20var(--bg3)%3B%20color%3A%20var(--text)%3B%20font-size%3A%2013px%3B%20font-family%3A%20inherit%3B%5Cnwidth%3A%20160px%3B%5Cn%7D%5Cn%2F*%20Clear%20lamp%20stats%20*%2F%5Cn.lamp-wrap%20%7B%20overflow-x%3A%20auto%3B%20%7D%5Cn.lamp-table%20th%2C%20.lamp-table%20td%20%7B%20text-align%3A%20center%3B%20padding%3A%204px%208px%3B%20font-size%3A%2012px%3B%20%7D%5Cn.lamp-table%20%7B%20font-size%3A%2012px%3B%20%7D%5Cn.lamp-noplay%20%7B%20color%3A%20%23bbb%3B%20%7D%5Cn.lamp-failed%20%7B%20color%3A%20%23d04040%3B%20%7D%5Cn.lamp-easy-clear%20%7B%20color%3A%20%232ea060%3B%20%7D%5Cn.lamp-clear%20%7B%20color%3A%20%23208020%3B%20%7D%5Cn.lamp-fc%20%7B%20color%3A%20%23c0a000%3B%20%7D%5Cn.lamp-perfect%20%7B%20color%3A%20%23d050d0%3B%20%7D%5Cn%2F*%20Footer%20*%2F%5Cn.footer%20%7B%20margin-top%3A%2040px%3B%20padding-top%3A%2012px%3B%20border-top%3A%201px%20solid%20var(--border)%3B%20font-size%3A%2011px%3B%20color%3A%20var(--text2)%3B%20text-align%3A%20center%3B%20%7D%5Cn%2F*%20Canvas%20for%20image%20export%20(hidden)%20*%2F%5Cn%23exportCanvas%20%7B%20display%3A%20none%3B%20%7D%5Cn%3C%2Fstyle%3E%5Cn%3C%2Fhead%3E%5Cn%3Cbody%3E%5Cn%3Cdiv%20class%3D%22container%22%3E%5Cn%3C!--%20Header%20--%3E%5Cn%3Cdiv%20class%3D%22header%22%3E%5Cn%3Ch1%3EPop%5C'n%20Score%20Tool%3C%2Fh1%3E%5Cn%3Cdiv%20class%3D%22player-info%22%20id%3D%22playerInfo%22%3E%3C%2Fdiv%3E%5Cn%3C%2Fdiv%3E%5Cn%3C!--%20Tabs%20--%3E%5Cn%3Cdiv%20class%3D%22tabs%22%20id%3D%22tabs%22%3E%5Cn%3Cbutton%20class%3D%22tab%20active%22%20data-tab%3D%22popclass%22%3EPop%5C'n%20Class%3C%2Fbutton%3E%5Cn%3Cbutton%20class%3D%22tab%22%20data-tab%3D%22scores%22%3EScore%20Browser%3C%2Fbutton%3E%5Cn%3Cbutton%20class%3D%22tab%22%20data-tab%3D%22lamps%22%3EClear%20Lamp%20Stats%3C%2Fbutton%3E%5Cn%3Cbutton%20class%3D%22tab%22%20data-tab%3D%22ranks%22%3ERank%20Stats%3C%2Fbutton%3E%5Cn%3C%2Fdiv%3E%5Cn%3C!--%20Pop%20Class%20Panel%20--%3E%5Cn%3Cdiv%20class%3D%22tab-panel%20active%22%20id%3D%22panel-popclass%22%3E%5Cn%3Cdiv%20class%3D%22popclass-card%22%20id%3D%22popclassCard%22%3E%3C%2Fdiv%3E%5Cn%3Cdiv%20class%3D%22top50-section%22%3E%5Cn%3Ch2%3ETop%2050%20Charts%3C%2Fh2%3E%5Cn%3Cbutton%20class%3D%22export-btn%22%20id%3D%22btnExportImg%22%3EExport%20as%20Image%3C%2Fbutton%3E%5Cn%3Cdiv%20class%3D%22top50-flex%22%20id%3D%22top50Flex%22%3E%3C%2Fdiv%3E%5Cn%3C%2Fdiv%3E%5Cn%3C%2Fdiv%3E%5Cn%3C!--%20Score%20Browser%20Panel%20--%3E%5Cn%3Cdiv%20class%3D%22tab-panel%22%20id%3D%22panel-scores%22%3E%5Cn%3Cdiv%20class%3D%22filters%22%20id%3D%22filtersContainer%22%3E%3C%2Fdiv%3E%5Cn%3Cdiv%20style%3D%22font-size%3A12px%3Bcolor%3Avar(--text2)%3Bmargin-bottom%3A8px%3B%22%20id%3D%22scoreCount%22%3E%3C%2Fdiv%3E%5Cn%3Ctable%20class%3D%22data-table%22%20id%3D%22scoreTable%22%3E%5Cn%3Cthead%3E%5Cn%3Ctr%3E%5Cn%3Cth%20data-sort%3D%22title%22%3EGenre%20%2F%20Title%3C%2Fth%3E%5Cn%3Cth%20data-sort%3D%22artist%22%3EArtist%3C%2Fth%3E%5Cn%3Cth%20data-sort%3D%22diff%22%3EDiff%3C%2Fth%3E%5Cn%3Cth%20data-sort%3D%22level%22%3ELv%3C%2Fth%3E%5Cn%3Cth%20data-sort%3D%22score%22%3EScore%3C%2Fth%3E%5Cn%3Cth%20data-sort%3D%22medal%22%3EMedal%3C%2Fth%3E%5Cn%3Cth%20data-sort%3D%22rank%22%3ERank%3C%2Fth%3E%5Cn%3C%2Ftr%3E%5Cn%3C%2Fthead%3E%5Cn%3Ctbody%3E%3C%2Ftbody%3E%5Cn%3C%2Ftable%3E%5Cn%3C%2Fdiv%3E%5Cn%3C!--%20Clear%20Lamp%20Stats%20Panel%20--%3E%5Cn%3Cdiv%20class%3D%22tab-panel%22%20id%3D%22panel-lamps%22%3E%5Cn%3Ch2%3EClear%20Lamp%20per%20Level%3C%2Fh2%3E%5Cn%3Cdiv%20class%3D%22lamp-wrap%22%3E%5Cn%3Ctable%20class%3D%22data-table%20lamp-table%22%20id%3D%22lampTable%22%3E%5Cn%3Cthead%3E%3Ctr%20id%3D%22lampHeader%22%3E%3C%2Ftr%3E%3C%2Fthead%3E%5Cn%3Ctbody%3E%3C%2Ftbody%3E%5Cn%3C%2Ftable%3E%5Cn%3C%2Fdiv%3E%5Cn%3C%2Fdiv%3E%5Cn%3C!--%20Rank%20Stats%20Panel%20--%3E%5Cn%3Cdiv%20class%3D%22tab-panel%22%20id%3D%22panel-ranks%22%3E%5Cn%3Ch2%3ERank%20per%20Level%3C%2Fh2%3E%5Cn%3Cdiv%20class%3D%22lamp-wrap%22%3E%5Cn%3Ctable%20class%3D%22data-table%20lamp-table%22%20id%3D%22rankTable%22%3E%5Cn%3Cthead%3E%3Ctr%20id%3D%22rankHeader%22%3E%3C%2Ftr%3E%3C%2Fthead%3E%5Cn%3Ctbody%3E%3C%2Ftbody%3E%5Cn%3C%2Ftable%3E%5Cn%3C%2Fdiv%3E%5Cn%3C%2Fdiv%3E%5Cn%3Cdiv%20class%3D%22footer%22%3E%5CnPop%5C'n%20Score%20Tool%20%26mdash%3B%20generated%20%3Cspan%20id%3D%22exportDate%22%3E%3C%2Fspan%3E%5Cn%3C%2Fdiv%3E%5Cn%3C%2Fdiv%3E%5Cn%3Ccanvas%20id%3D%22exportCanvas%22%3E%3C%2Fcanvas%3E%5Cn%3Cscript%3E%5Cn%2F%2F%20%3D%3D%3D%20Embedded%20data%20(replaced%20by%20build%20script)%20%3D%3D%3D%5Cnvar%20DATA%20%3D%20%7B%7BDATA_PLACEHOLDER%7D%7D%3B%5Cn%2F%2F%20%3D%3D%3D%20Constants%20%3D%3D%3D%5Cnvar%20CLASS_TIERS%20%3D%20%5B%5Cn%7B%20min%3A%2091%2C%20name%3A%20%5C'%5C%5Cu795e%5C'%2C%20color%3A%20%5C'%23d0203a%5C'%20%7D%2C%5Cn%7B%20min%3A%2079%2C%20name%3A%20%5C'%5C%5Cu4ed9%5C%5Cu4eba%5C'%2C%20color%3A%20%5C'%23c03050%5C'%20%7D%2C%5Cn%7B%20min%3A%2068%2C%20name%3A%20%5C'%5C%5Cu5c06%5C%5Cu8ecd%5C'%2C%20color%3A%20%5C'%23c08020%5C'%20%7D%2C%5Cn%7B%20min%3A%2059%2C%20name%3A%20%5C'%5C%5Cu30a2%5C%5Cu30a4%5C%5Cu30c9%5C%5Cu30eb%5C'%2C%20color%3A%20%5C'%23b0a010%5C'%20%7D%2C%5Cn%7B%20min%3A%2046%2C%20name%3A%20%5C'%5C%5Cu5211%5C%5Cu4e8b%5C'%2C%20color%3A%20%5C'%23209040%5C'%20%7D%2C%5Cn%7B%20min%3A%2034%2C%20name%3A%20%5C'%5C%5Cu756a%5C%5Cu9577%5C'%2C%20color%3A%20%5C'%231a9080%5C'%20%7D%2C%5Cn%7B%20min%3A%2021%2C%20name%3A%20%5C'%5C%5Cu5c0f%5C%5Cu5b66%5C%5Cu751f%5C'%2C%20color%3A%20%5C'%232e70c0%5C'%20%7D%2C%5Cn%7B%20min%3A%200%2C%20name%3A%20%5C'%5C%5Cu306b%5C%5Cu3083%5C%5Cu3093%5C%5Cu3053%5C'%2C%20color%3A%20%5C'%23907860%5C'%20%7D%2C%5Cn%5D%3B%5Cnvar%20MEDAL_ORDER%20%3D%20%5B%5Cn%5C'no_play%5C'%2C%5Cn%5C'failed_1%5C'%2C%20%5C'failed_2%5C'%2C%20%5C'failed_3%5C'%2C%5Cn%5C'easy_clear%5C'%2C%5Cn%5C'normal_clear%5C'%2C%20%5C'normal_clear_in_20_bad%5C'%2C%20%5C'normal_clear_in_5_bad%5C'%2C%5Cn%5C'full_combo%5C'%2C%20%5C'full_combo_in_20_good%5C'%2C%20%5C'full_combo_in_5_good%5C'%2C%5Cn%5C'perfect%5C'%5Cn%5D%3B%5Cnvar%20MEDAL_LABELS%20%3D%20%7B%5Cn%5C'no_play%5C'%3A%20%5C'No%20Play%5C'%2C%20%5C'easy_clear%5C'%3A%20%5C'%5C%5Cu7dd1%5C%5Cu2b24%5C'%2C%5Cn%5C'failed_1%5C'%3A%20%5C'%5C%5Cu7070%5C%5Cu2b24%5C'%2C%20%5C'failed_2%5C'%3A%20%5C'%5C%5Cu7070%5C%5Cu25c6%5C'%2C%20%5C'failed_3%5C'%3A%20%5C'%5C%5Cu7070%5C%5Cu2605%5C'%2C%5Cn%5C'normal_clear%5C'%3A%20%5C'%5C%5Cu9285%5C%5Cu2b24%5C'%2C%20%5C'normal_clear_in_20_bad%5C'%3A%20%5C'%5C%5Cu9285%5C%5Cu25c6%5C'%2C%20%5C'normal_clear_in_5_bad%5C'%3A%20%5C'%5C%5Cu9285%5C%5Cu2605%5C'%2C%5Cn%5C'full_combo%5C'%3A%20%5C'%5C%5Cu9280%5C%5Cu2b24%5C'%2C%20%5C'full_combo_in_20_good%5C'%3A%20%5C'%5C%5Cu9280%5C%5Cu25c6%5C'%2C%20%5C'full_combo_in_5_good%5C'%3A%20%5C'%5C%5Cu9280%5C%5Cu2605%5C'%2C%5Cn%5C'perfect%5C'%3A%20%5C'%5C%5Cu91d1%5C%5Cu2605%5C'%5Cn%7D%3B%5Cnvar%20MEDAL_COLORS%20%3D%20%7B%5Cn%5C'no_play%5C'%3A%20%5C'%23bbb%5C'%2C%20%5C'easy_clear%5C'%3A%20%5C'%232ea868%5C'%2C%5Cn%5C'failed_1%5C'%3A%20%5C'%23999%5C'%2C%20%5C'failed_2%5C'%3A%20%5C'%23999%5C'%2C%20%5C'failed_3%5C'%3A%20%5C'%23999%5C'%2C%5Cn%5C'normal_clear%5C'%3A%20%5C'%23b87333%5C'%2C%20%5C'normal_clear_in_20_bad%5C'%3A%20%5C'%23b87333%5C'%2C%20%5C'normal_clear_in_5_bad%5C'%3A%20%5C'%23b87333%5C'%2C%5Cn%5C'full_combo%5C'%3A%20%5C'%23888%5C'%2C%20%5C'full_combo_in_20_good%5C'%3A%20%5C'%23888%5C'%2C%20%5C'full_combo_in_5_good%5C'%3A%20%5C'%23888%5C'%2C%5Cn%5C'perfect%5C'%3A%20%5C'%23d4a017%5C'%5Cn%7D%3B%5Cnvar%20DIFF_COLORS%20%3D%20%7B%20easy%3A%20%5C'%231ea868%5C'%2C%20normal%3A%20%5C'%232e7ed6%5C'%2C%20hyper%3A%20%5C'%23d08a10%5C'%2C%20ex%3A%20%5C'%23d04030%5C'%20%7D%3B%5Cnvar%20RANK_ORDER%20%3D%20%5B%5C'E%5C'%2C%20%5C'D%5C'%2C%20%5C'C%5C'%2C%20%5C'B%5C'%2C%20%5C'A%5C'%2C%20%5C'AA%5C'%2C%20%5C'AAA%5C'%2C%20%5C'S%5C'%5D%3B%5Cn%2F%2F%20%3D%3D%3D%20Pop%20Class%20Calculation%20%3D%3D%3D%5Cnfunction%20medalBonus(medal)%20%7B%5Cnif%20(!medal)%20return%200%3B%5Cnif%20(medal%20%3D%3D%3D%20%5C'easy_clear%5C'%20%7C%7C%20medal.indexOf(%5C'normal_clear%5C')%20%3D%3D%3D%200)%20return%203000%3B%5Cnif%20(medal.indexOf(%5C'full_combo%5C')%20%3D%3D%3D%200%20%7C%7C%20medal%20%3D%3D%3D%20%5C'perfect%5C')%20return%205000%3B%5Cnreturn%200%3B%5Cn%7D%5Cnfunction%20calcClassPoints(lv%2C%20score%2C%20medal)%20%7B%5Cnif%20(!score%20%7C%7C%20score%20%3C%2050000)%20return%200%3B%5Cnvar%20raw%20%3D%20(10000%20*%20lv%20%2B%20score%20-%2050000%20%2B%20medalBonus(medal))%20%2F%205440%3B%5Cnreturn%20Math.min(Math.floor(raw%20*%20100)%20%2F%20100%2C%20100)%3B%5Cn%7D%5Cnfunction%20getTier(value)%20%7B%5Cnfor%20(var%20i%20%3D%200%3B%20i%20%3C%20CLASS_TIERS.length%3B%20i%2B%2B)%20%7B%5Cnif%20(value%20%3E%3D%20CLASS_TIERS%5Bi%5D.min)%20return%20CLASS_TIERS%5Bi%5D%3B%5Cn%7D%5Cnreturn%20CLASS_TIERS%5BCLASS_TIERS.length%20-%201%5D%3B%5Cn%7D%5Cnfunction%20getNextTier(value)%20%7B%5Cnfor%20(var%20i%20%3D%20CLASS_TIERS.length%20-%201%3B%20i%20%3E%3D%200%3B%20i--)%20%7B%5Cnif%20(CLASS_TIERS%5Bi%5D.min%20%3E%20value)%20return%20CLASS_TIERS%5Bi%5D%3B%5Cn%7D%5Cnreturn%20null%3B%5Cn%7D%5Cn%2F%2F%20%3D%3D%3D%20Flatten%20scores%20into%20per-chart%20rows%20%3D%3D%3D%5Cnvar%20allCharts%20%3D%20%5B%5D%3B%5Cn(function()%20%7B%5Cnvar%20scores%20%3D%20DATA.scores%20%7C%7C%20%5B%5D%3B%5Cnfor%20(var%20si%20%3D%200%3B%20si%20%3C%20scores.length%3B%20si%2B%2B)%20%7B%5Cnvar%20song%20%3D%20scores%5Bsi%5D%3B%5Cnvar%20charts%20%3D%20song.charts%20%7C%7C%20%7B%7D%3B%5Cnvar%20diffs%20%3D%20%5B%5C'easy%5C'%2C%20%5C'normal%5C'%2C%20%5C'hyper%5C'%2C%20%5C'ex%5C'%5D%3B%5Cnfor%20(var%20di%20%3D%200%3B%20di%20%3C%20diffs.length%3B%20di%2B%2B)%20%7B%5Cnvar%20d%20%3D%20diffs%5Bdi%5D%3B%5Cnif%20(!charts%5Bd%5D)%20continue%3B%5Cnvar%20c%20%3D%20charts%5Bd%5D%3B%5CnallCharts.push(%7B%5Cntitle%3A%20song.title%2C%5Cngenre%3A%20song.genre%2C%5Cnartist%3A%20song.artist%2C%5Cndiff%3A%20d%2C%5Cnlevel%3A%20c.level%20%7C%7C%200%2C%5Cnscore%3A%20c.score%20%7C%7C%200%2C%5Cnmedal%3A%20c.medal%20%7C%7C%20%5C'no_play%5C'%2C%5Cnrank%3A%20c.rank%20%7C%7C%20null%2C%5CnclassPoints%3A%20calcClassPoints(c.level%20%7C%7C%200%2C%20c.score%20%7C%7C%200%2C%20c.medal)%2C%5Cn%7D)%3B%5Cn%7D%5Cn%7D%5Cn%7D)()%3B%5Cn%2F%2F%20%3D%3D%3D%20Calculate%20Pop%20Class%20%3D%3D%3D%5Cnvar%20top50Charts%20%3D%20%5B%5D%3B%5Cnvar%20popClassValue%20%3D%200%3B%5Cn(function()%20%7B%5Cnvar%20sorted%20%3D%20allCharts.slice().sort(function(a%2C%20b)%20%7B%20return%20b.classPoints%20-%20a.classPoints%3B%20%7D)%3B%5Cntop50Charts%20%3D%20sorted.slice(0%2C%2050)%3B%5Cnvar%20sum%20%3D%200%3B%5Cnfor%20(var%20i%20%3D%200%3B%20i%20%3C%20top50Charts.length%3B%20i%2B%2B)%20sum%20%2B%3D%20top50Charts%5Bi%5D.classPoints%3B%5CnpopClassValue%20%3D%20top50Charts.length%20%3E%200%20%3F%20Math.floor((sum%20%2F%20Math.min(top50Charts.length%2C%2050))%20*%20100)%20%2F%20100%20%3A%200%3B%5Cn%7D)()%3B%5Cn%2F%2F%20%3D%3D%3D%20Render%20Player%20Info%20%3D%3D%3D%5Cn(function()%20%7B%5Cnvar%20p%20%3D%20DATA.player%20%7C%7C%20%7B%7D%3B%5Cnvar%20info%20%3D%20document.getElementById(%5C'playerInfo%5C')%3B%5Cnvar%20html%20%3D%20%5C'%5C'%3B%5Cnvar%20chara%20%3D%20p%5B%5C'%5C%5Cu4f7f%5C%5Cu7528%5C%5Cu30ad%5C%5Cu30e3%5C%5Cu30e9%5C%5Cu30af%5C%5Cu30bf%5C%5Cu30fc%5C'%5D%3B%5Cnif%20(chara%20%26%26%20chara.imgData)%20%7B%5Cnhtml%20%2B%3D%20%5C'%3Cimg%20class%3D%22avatar%22%20src%3D%22%5C'%20%2B%20chara.imgData%20%2B%20%5C'%22%20alt%3D%22%5C'%20%2B%20esc(chara.name%20%7C%7C%20%5C'%5C')%20%2B%20%5C'%22%20title%3D%22%5C'%20%2B%20esc(chara.name%20%7C%7C%20%5C'%5C')%20%2B%20%5C'%22%3E%5C'%3B%5Cn%7D%5Cnvar%20tags%20%3D%20%5B%5D%3B%5Cnif%20(p%5B%5C'%5C%5Cu30d7%5C%5Cu30ec%5C%5Cu30fc%5C%5Cu30e4%5C%5Cu30fc%5C%5Cu540d%5C'%5D)%20tags.push(%5C'%3Cb%3E%5C'%20%2B%20esc(p%5B%5C'%5C%5Cu30d7%5C%5Cu30ec%5C%5Cu30fc%5C%5Cu30e4%5C%5Cu30fc%5C%5Cu540d%5C'%5D)%20%2B%20%5C'%3C%2Fb%3E%5C')%3B%5Cnif%20(p%5B%5C'%5C%5Cu30dd%5C%5Cu30d7%5C%5Cu3068%5C%5Cu3082ID%5C'%5D)%20tags.push(%5C'ID%3A%20%5C'%20%2B%20esc(p%5B%5C'%5C%5Cu30dd%5C%5Cu30d7%5C%5Cu3068%5C%5Cu3082ID%5C'%5D))%3B%5Cnif%20(p%5B%5C'NORMAL%5C%5Cu30e2%5C%5Cu30fc%5C%5Cu30c9%5C%5Cu30d7%5C%5Cu30ec%5C%5Cu30fc%5C%5Cu6570%5C'%5D)%20tags.push(%5C'Plays%3A%20%5C'%20%2B%20esc(p%5B%5C'NORMAL%5C%5Cu30e2%5C%5Cu30fc%5C%5Cu30c9%5C%5Cu30d7%5C%5Cu30ec%5C%5Cu30fc%5C%5Cu6570%5C'%5D))%3B%5Cnif%20(p%5B%5C'%5C%5Cu6700%5C%5Cu7d42%5C%5Cu30d7%5C%5Cu30ec%5C%5Cu30fc%5C%5Cu65e5%5C%5Cu6642%5C'%5D)%20tags.push(%5C'Last%3A%20%5C'%20%2B%20esc(p%5B%5C'%5C%5Cu6700%5C%5Cu7d42%5C%5Cu30d7%5C%5Cu30ec%5C%5Cu30fc%5C%5Cu65e5%5C%5Cu6642%5C'%5D))%3B%5Cnhtml%20%2B%3D%20tags.map(function(t)%20%7B%20return%20%5C'%3Cspan%20class%3D%22tag%22%3E%5C'%20%2B%20t%20%2B%20%5C'%3C%2Fspan%3E%5C'%3B%20%7D).join(%5C'%5C')%3B%5Cninfo.innerHTML%20%3D%20html%3B%5Cndocument.getElementById(%5C'exportDate%5C').textContent%20%3D%20DATA.exportedAt%20%7C%7C%20%5C'%5C'%3B%5Cn%7D)()%3B%5Cn%2F%2F%20%3D%3D%3D%20Render%20Pop%20Class%20Card%20%3D%3D%3D%5Cn(function()%20%7B%5Cnvar%20card%20%3D%20document.getElementById(%5C'popclassCard%5C')%3B%5Cnvar%20tier%20%3D%20getTier(popClassValue)%3B%5Cnvar%20next%20%3D%20getNextTier(popClassValue)%3B%5Cnvar%20progress%20%3D%20100%3B%5Cnvar%20progressLabel%20%3D%20%5C'MAX%5C'%3B%5Cnif%20(next)%20%7B%5Cnprogress%20%3D%20((popClassValue%20-%20tier.min)%20%2F%20(next.min%20-%20tier.min))%20*%20100%3B%5CnprogressLabel%20%3D%20%5C'Next%3A%20%5C'%20%2B%20next.name%20%2B%20%5C'%20(%5C'%20%2B%20next.min.toFixed(2)%20%2B%20%5C')%5C'%3B%5Cn%7D%5Cncard.innerHTML%20%3D%5Cn%5C'%3Cdiv%20class%3D%22popclass-value%22%20style%3D%22color%3A%5C'%20%2B%20tier.color%20%2B%20%5C'%22%3E%5C'%20%2B%20popClassValue.toFixed(2)%20%2B%20%5C'%3C%2Fdiv%3E%5C'%20%2B%5Cn%5C'%3Cdiv%20class%3D%22popclass-tier%22%20style%3D%22color%3A%5C'%20%2B%20tier.color%20%2B%20%5C'%22%3E%5C'%20%2B%20tier.name%20%2B%20%5C'%3C%2Fdiv%3E%5C'%20%2B%5Cn%5C'%3Cdiv%20class%3D%22popclass-bar-wrap%22%3E%3Cdiv%20class%3D%22popclass-bar%22%20style%3D%22width%3A%5C'%20%2B%20Math.min(progress%2C%20100)%20%2B%20%5C'%25%3Bbackground%3A%5C'%20%2B%20tier.color%20%2B%20%5C'%22%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%5C'%20%2B%5Cn%5C'%3Cdiv%20class%3D%22popclass-sub%22%3E%5C'%20%2B%20progressLabel%20%2B%20%5C'%20%7C%20Top%2050%20avg%20of%20%5C'%20%2B%20allCharts.filter(function(c)%7Breturn%20c.classPoints%3E0%3B%7D).length%20%2B%20%5C'%20scored%20charts%3C%2Fdiv%3E%5C'%3B%5Cn%7D)()%3B%5Cn%2F%2F%20%3D%3D%3D%20Render%20Top%2050%20Table%20(two%20columns)%20%3D%3D%3D%5Cn(function()%20%7B%5Cnvar%20flex%20%3D%20document.getElementById(%5C'top50Flex%5C')%3B%5Cnvar%20half%20%3D%20Math.min(top50Charts.length%2C%2025)%3B%5Cnfunction%20buildTable(start%2C%20end)%20%7B%5Cnvar%20html%20%3D%20%5C'%3Ctable%20class%3D%22data-table%22%3E%3Cthead%3E%3Ctr%3E%5C'%20%2B%5Cn%5C'%3Cth%3E%23%3C%2Fth%3E%3Cth%3EGenre%20%2F%20Title%3C%2Fth%3E%3Cth%3EDiff%3C%2Fth%3E%3Cth%3ELv%3C%2Fth%3E%5C'%20%2B%5Cn%5C'%3Cth%3EScore%3C%2Fth%3E%3Cth%3EMedal%3C%2Fth%3E%3Cth%3EClass%20Pts%3C%2Fth%3E%5C'%20%2B%5Cn%5C'%3C%2Ftr%3E%3C%2Fthead%3E%3Ctbody%3E%5C'%3B%5Cnfor%20(var%20i%20%3D%20start%3B%20i%20%3C%20end%3B%20i%2B%2B)%20%7B%5Cnvar%20c%20%3D%20top50Charts%5Bi%5D%3B%5Cnhtml%20%2B%3D%20%5C'%3Ctr%3E%5C'%20%2B%5Cn%5C'%3Ctd%3E%5C'%20%2B%20(i%20%2B%201)%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3Ctd%20title%3D%22%5C'%20%2B%20esc(c.artist)%20%2B%20%5C'%22%3E%5C'%20%2B%20esc(displayTitle(c.title%2C%20c.genre))%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3Ctd%20class%3D%22diff-%5C'%20%2B%20c.diff%20%2B%20%5C'%22%3E%5C'%20%2B%20c.diff.toUpperCase()%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3Ctd%3E%5C'%20%2B%20c.level%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3Ctd%20class%3D%22score-cell%22%3E%5C'%20%2B%20(c.score%20%3E%200%20%3F%20c.score%20%3A%20%5C'-%5C')%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3Ctd%20class%3D%22medal-cell%22%20style%3D%22color%3A%5C'%20%2B%20(MEDAL_COLORS%5Bc.medal%5D%20%7C%7C%20%5C'%23555%5C')%20%2B%20%5C'%22%3E%5C'%20%2B%20(MEDAL_LABELS%5Bc.medal%5D%20%7C%7C%20c.medal)%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3Ctd%20class%3D%22score-cell%22%20style%3D%22color%3Avar(--accent)%22%3E%5C'%20%2B%20c.classPoints.toFixed(2)%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3C%2Ftr%3E%5C'%3B%5Cn%7D%5Cnhtml%20%2B%3D%20%5C'%3C%2Ftbody%3E%3C%2Ftable%3E%5C'%3B%5Cnreturn%20html%3B%5Cn%7D%5Cnvar%20leftDiv%20%3D%20document.createElement(%5C'div%5C')%3B%5CnleftDiv.innerHTML%20%3D%20buildTable(0%2C%20half)%3B%5Cnflex.appendChild(leftDiv)%3B%5Cnif%20(top50Charts.length%20%3E%2025)%20%7B%5Cnvar%20rightDiv%20%3D%20document.createElement(%5C'div%5C')%3B%5CnrightDiv.innerHTML%20%3D%20buildTable(25%2C%20top50Charts.length)%3B%5Cnflex.appendChild(rightDiv)%3B%5Cn%7D%5Cn%7D)()%3B%5Cn%2F%2F%20%3D%3D%3D%20Score%20Browser%20%3D%3D%3D%5Cnvar%20scoreSort%20%3D%20%7B%20key%3A%20%5C'level%5C'%2C%20dir%3A%20-1%20%7D%3B%5Cn%2F%2F%20Build%20checkbox%20filters%5Cn(function()%20%7B%5Cnvar%20container%20%3D%20document.getElementById(%5C'filtersContainer%5C')%3B%5Cn%2F%2F%20Difficulty%20checkboxes%5Cnvar%20diffGroup%20%3D%20document.createElement(%5C'div%5C')%3B%5CndiffGroup.className%20%3D%20%5C'filter-group%5C'%3B%5CndiffGroup.innerHTML%20%3D%20%5C'%3Cdiv%20class%3D%22filter-label%22%3EDifficulty%3C%2Fdiv%3E%3Cdiv%20class%3D%22filter-opts%22%20id%3D%22filterDiffOpts%22%3E%3C%2Fdiv%3E%5C'%3B%5Cncontainer.appendChild(diffGroup)%3B%5Cnvar%20diffOpts%20%3D%20document.getElementById(%5C'filterDiffOpts%5C')%3B%5Cn%5B%5C'easy%5C'%2C%5C'normal%5C'%2C%5C'hyper%5C'%2C%5C'ex%5C'%5D.forEach(function(d)%20%7B%5Cnvar%20lbl%20%3D%20document.createElement(%5C'label%5C')%3B%5Cnlbl.className%20%3D%20%5C'checked%5C'%3B%5Cnlbl.innerHTML%20%3D%20%5C'%3Cinput%20type%3D%22checkbox%22%20checked%20data-diff%3D%22%5C'%20%2B%20d%20%2B%20%5C'%22%3E%20%3Cspan%20class%3D%22diff-%5C'%20%2B%20d%20%2B%20%5C'%22%3E%5C'%20%2B%20d.toUpperCase()%20%2B%20%5C'%3C%2Fspan%3E%5C'%3B%5Cnlbl.querySelector(%5C'input%5C').addEventListener(%5C'change%5C'%2C%20function()%20%7B%5Cnlbl.className%20%3D%20this.checked%20%3F%20%5C'checked%5C'%20%3A%20%5C'%5C'%3B%5CnrenderScoreTable()%3B%5Cn%7D)%3B%5CndiffOpts.appendChild(lbl)%3B%5Cn%7D)%3B%5Cn%2F%2F%20Level%20checkboxes%5Cnvar%20lvGroup%20%3D%20document.createElement(%5C'div%5C')%3B%5CnlvGroup.className%20%3D%20%5C'filter-group%5C'%3B%5CnlvGroup.innerHTML%20%3D%20%5C'%3Cdiv%20class%3D%22filter-label%22%3ELevel%20%3Cspan%20class%3D%22toggle-link%22%20id%3D%22lvAll%22%3EAll%3C%2Fspan%3E%20%3Cspan%20class%3D%22toggle-link%22%20id%3D%22lvNone%22%3ENone%3C%2Fspan%3E%3C%2Fdiv%3E%3Cdiv%20class%3D%22filter-opts%22%20id%3D%22filterLvOpts%22%3E%3C%2Fdiv%3E%5C'%3B%5Cncontainer.appendChild(lvGroup)%3B%5Cnvar%20lvOpts%20%3D%20document.getElementById(%5C'filterLvOpts%5C')%3B%5Cnfor%20(var%20i%20%3D%201%3B%20i%20%3C%3D%2050%3B%20i%2B%2B)%20%7B%5Cnvar%20lbl%20%3D%20document.createElement(%5C'label%5C')%3B%5Cnlbl.className%20%3D%20%5C'checked%5C'%3B%5Cnlbl.innerHTML%20%3D%20%5C'%3Cinput%20type%3D%22checkbox%22%20checked%20data-lv%3D%22%5C'%20%2B%20i%20%2B%20%5C'%22%3E%20%5C'%20%2B%20i%3B%5Cnlbl.querySelector(%5C'input%5C').addEventListener(%5C'change%5C'%2C%20function()%20%7B%5Cnthis.parentElement.className%20%3D%20this.checked%20%3F%20%5C'checked%5C'%20%3A%20%5C'%5C'%3B%5CnrenderScoreTable()%3B%5Cn%7D)%3B%5CnlvOpts.appendChild(lbl)%3B%5Cn%7D%5Cndocument.getElementById(%5C'lvAll%5C').addEventListener(%5C'click%5C'%2C%20function()%20%7B%5CnlvOpts.querySelectorAll(%5C'input%5C').forEach(function(cb)%20%7B%20cb.checked%20%3D%20true%3B%20cb.parentElement.className%20%3D%20%5C'checked%5C'%3B%20%7D)%3B%5CnrenderScoreTable()%3B%5Cn%7D)%3B%5Cndocument.getElementById(%5C'lvNone%5C').addEventListener(%5C'click%5C'%2C%20function()%20%7B%5CnlvOpts.querySelectorAll(%5C'input%5C').forEach(function(cb)%20%7B%20cb.checked%20%3D%20false%3B%20cb.parentElement.className%20%3D%20%5C'%5C'%3B%20%7D)%3B%5CnrenderScoreTable()%3B%5Cn%7D)%3B%5Cn%2F%2F%20Medal%20checkboxes%5Cnvar%20medalGroup%20%3D%20document.createElement(%5C'div%5C')%3B%5CnmedalGroup.className%20%3D%20%5C'filter-group%5C'%3B%5CnmedalGroup.innerHTML%20%3D%20%5C'%3Cdiv%20class%3D%22filter-label%22%3EMedal%20%3Cspan%20class%3D%22toggle-link%22%20id%3D%22medalAll%22%3EAll%3C%2Fspan%3E%20%3Cspan%20class%3D%22toggle-link%22%20id%3D%22medalNone%22%3ENone%3C%2Fspan%3E%3C%2Fdiv%3E%3Cdiv%20class%3D%22filter-opts%22%20id%3D%22filterMedalOpts%22%3E%3C%2Fdiv%3E%5C'%3B%5Cncontainer.appendChild(medalGroup)%3B%5Cnvar%20medalOpts%20%3D%20document.getElementById(%5C'filterMedalOpts%5C')%3B%5CnMEDAL_ORDER.forEach(function(m)%20%7B%5Cnvar%20lbl%20%3D%20document.createElement(%5C'label%5C')%3B%5Cnlbl.className%20%3D%20%5C'checked%5C'%3B%5Cnlbl.innerHTML%20%3D%20%5C'%3Cinput%20type%3D%22checkbox%22%20checked%20data-medal%3D%22%5C'%20%2B%20m%20%2B%20%5C'%22%3E%20%3Cspan%20style%3D%22color%3A%5C'%20%2B%20(MEDAL_COLORS%5Bm%5D%20%7C%7C%20%5C'%23555%5C')%20%2B%20%5C'%22%3E%5C'%20%2B%20(MEDAL_LABELS%5Bm%5D%20%7C%7C%20m)%20%2B%20%5C'%3C%2Fspan%3E%5C'%3B%5Cnlbl.querySelector(%5C'input%5C').addEventListener(%5C'change%5C'%2C%20function()%20%7B%5Cnthis.parentElement.className%20%3D%20this.checked%20%3F%20%5C'checked%5C'%20%3A%20%5C'%5C'%3B%5CnrenderScoreTable()%3B%5Cn%7D)%3B%5CnmedalOpts.appendChild(lbl)%3B%5Cn%7D)%3B%5Cndocument.getElementById(%5C'medalAll%5C').addEventListener(%5C'click%5C'%2C%20function()%20%7B%5CnmedalOpts.querySelectorAll(%5C'input%5C').forEach(function(cb)%20%7B%20cb.checked%20%3D%20true%3B%20cb.parentElement.className%20%3D%20%5C'checked%5C'%3B%20%7D)%3B%5CnrenderScoreTable()%3B%5Cn%7D)%3B%5Cndocument.getElementById(%5C'medalNone%5C').addEventListener(%5C'click%5C'%2C%20function()%20%7B%5CnmedalOpts.querySelectorAll(%5C'input%5C').forEach(function(cb)%20%7B%20cb.checked%20%3D%20false%3B%20cb.parentElement.className%20%3D%20%5C'%5C'%3B%20%7D)%3B%5CnrenderScoreTable()%3B%5Cn%7D)%3B%5Cn%2F%2F%20Search%5Cnvar%20searchGroup%20%3D%20document.createElement(%5C'div%5C')%3B%5CnsearchGroup.className%20%3D%20%5C'filter-group%5C'%3B%5CnsearchGroup.innerHTML%20%3D%20%5C'%3Cdiv%20class%3D%22filter-label%22%3ESearch%3C%2Fdiv%3E%3Cinput%20type%3D%22text%22%20class%3D%22filter-search%22%20id%3D%22filterSearch%22%20placeholder%3D%22Song%20title...%22%3E%5C'%3B%5Cncontainer.appendChild(searchGroup)%3B%5Cndocument.getElementById(%5C'filterSearch%5C').addEventListener(%5C'input%5C'%2C%20renderScoreTable)%3B%5Cn%7D)()%3B%5Cnfunction%20renderScoreTable()%20%7B%5Cnvar%20checkedDiffs%20%3D%20%7B%7D%3B%5Cndocument.querySelectorAll(%5C'%23filterDiffOpts%20input%3Achecked%5C').forEach(function(cb)%20%7B%5CncheckedDiffs%5Bcb.getAttribute(%5C'data-diff%5C')%5D%20%3D%20true%3B%5Cn%7D)%3B%5Cnvar%20checkedLvs%20%3D%20%7B%7D%3B%5Cndocument.querySelectorAll(%5C'%23filterLvOpts%20input%3Achecked%5C').forEach(function(cb)%20%7B%5CncheckedLvs%5BparseInt(cb.getAttribute(%5C'data-lv%5C'))%5D%20%3D%20true%3B%5Cn%7D)%3B%5Cnvar%20checkedMedals%20%3D%20%7B%7D%3B%5Cndocument.querySelectorAll(%5C'%23filterMedalOpts%20input%3Achecked%5C').forEach(function(cb)%20%7B%5CncheckedMedals%5Bcb.getAttribute(%5C'data-medal%5C')%5D%20%3D%20true%3B%5Cn%7D)%3B%5Cnvar%20search%20%3D%20document.getElementById(%5C'filterSearch%5C').value.toLowerCase()%3B%5Cnvar%20filtered%20%3D%20allCharts.filter(function(c)%20%7B%5Cnif%20(!checkedDiffs%5Bc.diff%5D)%20return%20false%3B%5Cnif%20(!checkedLvs%5Bc.level%5D)%20return%20false%3B%5Cnif%20(!checkedMedals%5Bc.medal%5D)%20return%20false%3B%5Cnif%20(search%20%26%26%20c.title.toLowerCase().indexOf(search)%20%3C%200%20%26%26%20(!c.genre%20%7C%7C%20c.genre.toLowerCase().indexOf(search)%20%3C%200))%20return%20false%3B%5Cnreturn%20true%3B%5Cn%7D)%3B%5Cnfiltered.sort(function(a%2C%20b)%20%7B%5Cnvar%20va%20%3D%20a%5BscoreSort.key%5D%2C%20vb%20%3D%20b%5BscoreSort.key%5D%3B%5Cnif%20(scoreSort.key%20%3D%3D%3D%20%5C'medal%5C')%20%7B%5Cnva%20%3D%20MEDAL_ORDER.indexOf(a.medal)%3B%5Cnvb%20%3D%20MEDAL_ORDER.indexOf(b.medal)%3B%5Cn%7D%5Cnif%20(scoreSort.key%20%3D%3D%3D%20%5C'rank%5C')%20%7B%5Cnva%20%3D%20a.rank%20%3F%20RANK_ORDER.indexOf(a.rank)%20%3A%20-1%3B%5Cnvb%20%3D%20b.rank%20%3F%20RANK_ORDER.indexOf(b.rank)%20%3A%20-1%3B%5Cn%7D%5Cnif%20(va%20%3D%3D%3D%20vb)%20return%200%3B%5Cnif%20(va%20%3D%3D%3D%20null%20%7C%7C%20va%20%3D%3D%3D%20undefined)%20return%201%3B%5Cnif%20(vb%20%3D%3D%3D%20null%20%7C%7C%20vb%20%3D%3D%3D%20undefined)%20return%20-1%3B%5Cnif%20(typeof%20va%20%3D%3D%3D%20%5C'string%5C')%20return%20va.localeCompare(vb)%20*%20scoreSort.dir%3B%5Cnreturn%20(va%20-%20vb)%20*%20scoreSort.dir%3B%5Cn%7D)%3B%5Cndocument.getElementById(%5C'scoreCount%5C').textContent%20%3D%20filtered.length%20%2B%20%5C'%20charts%5C'%3B%5Cnvar%20tbody%20%3D%20document.querySelector(%5C'%23scoreTable%20tbody%5C')%3B%5Cnvar%20html%20%3D%20%5C'%5C'%3B%5Cnvar%20limit%20%3D%20Math.min(filtered.length%2C%20500)%3B%5Cnfor%20(var%20i%20%3D%200%3B%20i%20%3C%20limit%3B%20i%2B%2B)%20%7B%5Cnvar%20c%20%3D%20filtered%5Bi%5D%3B%5Cnhtml%20%2B%3D%20%5C'%3Ctr%3E%5C'%20%2B%5Cn%5C'%3Ctd%3E%5C'%20%2B%20esc(displayTitle(c.title%2C%20c.genre))%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3Ctd%3E%5C'%20%2B%20esc(c.artist)%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3Ctd%20class%3D%22diff-%5C'%20%2B%20c.diff%20%2B%20%5C'%22%3E%5C'%20%2B%20c.diff.toUpperCase()%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3Ctd%3E%5C'%20%2B%20c.level%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3Ctd%20class%3D%22score-cell%22%3E%5C'%20%2B%20(c.score%20%3E%200%20%3F%20c.score%20%3A%20%5C'-%5C')%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3Ctd%20class%3D%22medal-cell%22%20style%3D%22color%3A%5C'%20%2B%20(MEDAL_COLORS%5Bc.medal%5D%20%7C%7C%20%5C'%23555%5C')%20%2B%20%5C'%22%3E%5C'%20%2B%20(MEDAL_LABELS%5Bc.medal%5D%20%7C%7C%20c.medal)%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3Ctd%3E%5C'%20%2B%20(c.rank%20%7C%7C%20%5C'-%5C')%20%2B%20%5C'%3C%2Ftd%3E%5C'%20%2B%5Cn%5C'%3C%2Ftr%3E%5C'%3B%5Cn%7D%5Cnif%20(filtered.length%20%3E%20500)%20%7B%5Cnhtml%20%2B%3D%20%5C'%3Ctr%3E%3Ctd%20colspan%3D%227%22%20style%3D%22text-align%3Acenter%3Bcolor%3Avar(--text2)%22%3E...%20and%20%5C'%20%2B%20(filtered.length%20-%20500)%20%2B%20%5C'%20more%3C%2Ftd%3E%3C%2Ftr%3E%5C'%3B%5Cn%7D%5Cntbody.innerHTML%20%3D%20html%3B%5Cn%7D%5Cn%2F%2F%20Sort%20headers%5Cndocument.querySelectorAll(%5C'%23scoreTable%20th%5Bdata-sort%5D%5C').forEach(function(th)%20%7B%5Cnth.addEventListener(%5C'click%5C'%2C%20function()%20%7B%5Cnvar%20key%20%3D%20this.getAttribute(%5C'data-sort%5C')%3B%5Cnif%20(scoreSort.key%20%3D%3D%3D%20key)%20%7B%5CnscoreSort.dir%20*%3D%20-1%3B%5Cn%7D%20else%20%7B%5CnscoreSort.key%20%3D%20key%3B%5CnscoreSort.dir%20%3D%20key%20%3D%3D%3D%20%5C'title%5C'%20%7C%7C%20key%20%3D%3D%3D%20%5C'artist%5C'%20%7C%7C%20key%20%3D%3D%3D%20%5C'diff%5C'%20%3F%201%20%3A%20-1%3B%5Cn%7D%5Cndocument.querySelectorAll(%5C'%23scoreTable%20th%5C').forEach(function(h)%20%7B%5Cnvar%20arrow%20%3D%20h.querySelector(%5C'.sort-arrow%5C')%3B%5Cnif%20(arrow)%20arrow.remove()%3B%5Cn%7D)%3B%5Cnvar%20arrow%20%3D%20document.createElement(%5C'span%5C')%3B%5Cnarrow.className%20%3D%20%5C'sort-arrow%5C'%3B%5Cnarrow.textContent%20%3D%20scoreSort.dir%20%3E%200%20%3F%20%5C'%20%5C%5Cu25b2%5C'%20%3A%20%5C'%20%5C%5Cu25bc%5C'%3B%5Cnthis.appendChild(arrow)%3B%5CnrenderScoreTable()%3B%5Cn%7D)%3B%5Cn%7D)%3B%5CnrenderScoreTable()%3B%5Cn%2F%2F%20%3D%3D%3D%20Clear%20Lamp%20Stats%20%3D%3D%3D%5Cn(function()%20%7B%5Cn%2F%2F%20Build%20header%5Cnvar%20headerRow%20%3D%20document.getElementById(%5C'lampHeader%5C')%3B%5Cnvar%20headerCols%20%3D%20%5B%5C'Lv%5C'%2C%20%5C'Total%5C'%5D%3B%5Cnfor%20(var%20mi%20%3D%200%3B%20mi%20%3C%20MEDAL_ORDER.length%3B%20mi%2B%2B)%20%7B%5CnheaderCols.push(MEDAL_LABELS%5BMEDAL_ORDER%5Bmi%5D%5D)%3B%5Cn%7D%5CnheaderRow.innerHTML%20%3D%20%5C'%3Cth%3E%5C'%20%2B%20headerCols%5B0%5D%20%2B%20%5C'%3C%2Fth%3E%3Cth%3E%5C'%20%2B%20headerCols%5B1%5D%20%2B%20%5C'%3C%2Fth%3E%5C'%3B%5Cnfor%20(var%20hi%20%3D%200%3B%20hi%20%3C%20MEDAL_ORDER.length%3B%20hi%2B%2B)%20%7B%5CnheaderRow.innerHTML%20%2B%3D%20%5C'%3Cth%20style%3D%22color%3A%5C'%20%2B%20(MEDAL_COLORS%5BMEDAL_ORDER%5Bhi%5D%5D%20%7C%7C%20%5C'%23555%5C')%20%2B%20%5C'%22%3E%5C'%20%2B%20headerCols%5Bhi%20%2B%202%5D%20%2B%20%5C'%3C%2Fth%3E%5C'%3B%5Cn%7D%5Cn%2F%2F%20Compute%20stats%5Cnvar%20lvStats%20%3D%20%7B%7D%3B%5Cnfor%20(var%20i%20%3D%200%3B%20i%20%3C%20allCharts.length%3B%20i%2B%2B)%20%7B%5Cnvar%20c%20%3D%20allCharts%5Bi%5D%3B%5Cnvar%20lv%20%3D%20c.level%3B%5Cnif%20(!lvStats%5Blv%5D)%20%7B%5CnlvStats%5Blv%5D%20%3D%20%7B%20total%3A%200%20%7D%3B%5Cnfor%20(var%20mi2%20%3D%200%3B%20mi2%20%3C%20MEDAL_ORDER.length%3B%20mi2%2B%2B)%20lvStats%5Blv%5D%5BMEDAL_ORDER%5Bmi2%5D%5D%20%3D%200%3B%5Cn%7D%5CnlvStats%5Blv%5D.total%2B%2B%3B%5Cnif%20(lvStats%5Blv%5D%5Bc.medal%5D%20!%3D%3D%20undefined)%20lvStats%5Blv%5D%5Bc.medal%5D%2B%2B%3B%5Cn%7D%5Cnvar%20tbody%20%3D%20document.querySelector(%5C'%23lampTable%20tbody%5C')%3B%5Cnvar%20html%20%3D%20%5C'%5C'%3B%5Cnvar%20levels%20%3D%20Object.keys(lvStats).map(Number).sort(function(a%2Cb)%7Breturn%20a-b%3B%7D)%3B%5Cnvar%20totals%20%3D%20%7B%20total%3A%200%20%7D%3B%5Cnfor%20(var%20mi4%20%3D%200%3B%20mi4%20%3C%20MEDAL_ORDER.length%3B%20mi4%2B%2B)%20totals%5BMEDAL_ORDER%5Bmi4%5D%5D%20%3D%200%3B%5Cnfor%20(var%20li%20%3D%200%3B%20li%20%3C%20levels.length%3B%20li%2B%2B)%20%7B%5Cnvar%20lv%20%3D%20levels%5Bli%5D%3B%5Cnvar%20s%20%3D%20lvStats%5Blv%5D%3B%5Cntotals.total%20%2B%3D%20s.total%3B%5Cnhtml%20%2B%3D%20%5C'%3Ctr%3E%3Ctd%3E%3Cb%3E%5C'%20%2B%20lv%20%2B%20%5C'%3C%2Fb%3E%3C%2Ftd%3E%3Ctd%3E%5C'%20%2B%20s.total%20%2B%20%5C'%3C%2Ftd%3E%5C'%3B%5Cnfor%20(var%20mi3%20%3D%200%3B%20mi3%20%3C%20MEDAL_ORDER.length%3B%20mi3%2B%2B)%20%7B%5Cnvar%20m%20%3D%20MEDAL_ORDER%5Bmi3%5D%3B%5Cnvar%20count%20%3D%20s%5Bm%5D%20%7C%7C%200%3B%5Cntotals%5Bm%5D%20%2B%3D%20count%3B%5Cnvar%20color%20%3D%20MEDAL_COLORS%5Bm%5D%20%7C%7C%20%5C'%23555%5C'%3B%5Cnhtml%20%2B%3D%20%5C'%3Ctd%20style%3D%22color%3A%5C'%20%2B%20color%20%2B%20%5C'%22%3E%5C'%20%2B%20(count%20%7C%7C%20%5C'-%5C')%20%2B%20%5C'%3C%2Ftd%3E%5C'%3B%5Cn%7D%5Cnhtml%20%2B%3D%20%5C'%3C%2Ftr%3E%5C'%3B%5Cn%7D%5Cn%2F%2F%20Total%20row%5Cnhtml%20%2B%3D%20%5C'%3Ctr%20style%3D%22border-top%3A2px%20solid%20var(--border)%3Bfont-weight%3Abold%22%3E%3Ctd%3ETotal%3C%2Ftd%3E%3Ctd%3E%5C'%20%2B%20totals.total%20%2B%20%5C'%3C%2Ftd%3E%5C'%3B%5Cnfor%20(var%20mi5%20%3D%200%3B%20mi5%20%3C%20MEDAL_ORDER.length%3B%20mi5%2B%2B)%20%7B%5Cnvar%20m2%20%3D%20MEDAL_ORDER%5Bmi5%5D%3B%5Cnvar%20color2%20%3D%20MEDAL_COLORS%5Bm2%5D%20%7C%7C%20%5C'%23555%5C'%3B%5Cnhtml%20%2B%3D%20%5C'%3Ctd%20style%3D%22color%3A%5C'%20%2B%20color2%20%2B%20%5C'%22%3E%5C'%20%2B%20(totals%5Bm2%5D%20%7C%7C%20%5C'-%5C')%20%2B%20%5C'%3C%2Ftd%3E%5C'%3B%5Cn%7D%5Cnhtml%20%2B%3D%20%5C'%3C%2Ftr%3E%5C'%3B%5Cntbody.innerHTML%20%3D%20html%3B%5Cn%7D)()%3B%5Cn%2F%2F%20%3D%3D%3D%20Rank%20Lamp%20Stats%20%3D%3D%3D%5Cn(function()%20%7B%5Cnvar%20RANK_DISPLAY%20%3D%20%5Bnull%2C%20%5C'E%5C'%2C%20%5C'D%5C'%2C%20%5C'C%5C'%2C%20%5C'B%5C'%2C%20%5C'A%5C'%2C%20%5C'AA%5C'%2C%20%5C'AAA%5C'%2C%20%5C'S%5C'%5D%3B%5Cnvar%20RANK_LABELS%20%3D%20%5B%5C'-%5C'%2C%20%5C'E%5C'%2C%20%5C'D%5C'%2C%20%5C'C%5C'%2C%20%5C'B%5C'%2C%20%5C'A%5C'%2C%20%5C'AA%5C'%2C%20%5C'AAA%5C'%2C%20%5C'S%5C'%5D%3B%5Cn%2F%2F%20Build%20header%5Cnvar%20headerRow%20%3D%20document.getElementById(%5C'rankHeader%5C')%3B%5CnheaderRow.innerHTML%20%3D%20%5C'%3Cth%3ELv%3C%2Fth%3E%3Cth%3ETotal%3C%2Fth%3E%5C'%3B%5Cnfor%20(var%20ri%20%3D%200%3B%20ri%20%3C%20RANK_LABELS.length%3B%20ri%2B%2B)%20%7B%5CnheaderRow.innerHTML%20%2B%3D%20%5C'%3Cth%3E%5C'%20%2B%20RANK_LABELS%5Bri%5D%20%2B%20%5C'%3C%2Fth%3E%5C'%3B%5Cn%7D%5Cn%2F%2F%20Compute%20stats%5Cnvar%20lvStats%20%3D%20%7B%7D%3B%5Cnfor%20(var%20i%20%3D%200%3B%20i%20%3C%20allCharts.length%3B%20i%2B%2B)%20%7B%5Cnvar%20c%20%3D%20allCharts%5Bi%5D%3B%5Cnvar%20lv%20%3D%20c.level%3B%5Cnif%20(!lvStats%5Blv%5D)%20%7B%5CnlvStats%5Blv%5D%20%3D%20%7B%20total%3A%200%20%7D%3B%5Cnfor%20(var%20ri2%20%3D%200%3B%20ri2%20%3C%20RANK_DISPLAY.length%3B%20ri2%2B%2B)%20lvStats%5Blv%5D%5BString(RANK_DISPLAY%5Bri2%5D)%5D%20%3D%200%3B%5Cn%7D%5CnlvStats%5Blv%5D.total%2B%2B%3B%5CnlvStats%5Blv%5D%5BString(c.rank)%5D%2B%2B%3B%5Cn%7D%5Cnvar%20tbody%20%3D%20document.querySelector(%5C'%23rankTable%20tbody%5C')%3B%5Cnvar%20html%20%3D%20%5C'%5C'%3B%5Cnvar%20levels%20%3D%20Object.keys(lvStats).map(Number).sort(function(a%2Cb)%7Breturn%20a-b%3B%7D)%3B%5Cnvar%20totals%20%3D%20%7B%20total%3A%200%20%7D%3B%5Cnfor%20(var%20ri3%20%3D%200%3B%20ri3%20%3C%20RANK_DISPLAY.length%3B%20ri3%2B%2B)%20totals%5BString(RANK_DISPLAY%5Bri3%5D)%5D%20%3D%200%3B%5Cnfor%20(var%20li%20%3D%200%3B%20li%20%3C%20levels.length%3B%20li%2B%2B)%20%7B%5Cnvar%20lv%20%3D%20levels%5Bli%5D%3B%5Cnvar%20s%20%3D%20lvStats%5Blv%5D%3B%5Cntotals.total%20%2B%3D%20s.total%3B%5Cnhtml%20%2B%3D%20%5C'%3Ctr%3E%3Ctd%3E%3Cb%3E%5C'%20%2B%20lv%20%2B%20%5C'%3C%2Fb%3E%3C%2Ftd%3E%3Ctd%3E%5C'%20%2B%20s.total%20%2B%20%5C'%3C%2Ftd%3E%5C'%3B%5Cnfor%20(var%20ri4%20%3D%200%3B%20ri4%20%3C%20RANK_DISPLAY.length%3B%20ri4%2B%2B)%20%7B%5Cnvar%20count%20%3D%20s%5BString(RANK_DISPLAY%5Bri4%5D)%5D%20%7C%7C%200%3B%5Cntotals%5BString(RANK_DISPLAY%5Bri4%5D)%5D%20%2B%3D%20count%3B%5Cnhtml%20%2B%3D%20%5C'%3Ctd%3E%5C'%20%2B%20(count%20%7C%7C%20%5C'-%5C')%20%2B%20%5C'%3C%2Ftd%3E%5C'%3B%5Cn%7D%5Cnhtml%20%2B%3D%20%5C'%3C%2Ftr%3E%5C'%3B%5Cn%7D%5Cn%2F%2F%20Total%20row%5Cnhtml%20%2B%3D%20%5C'%3Ctr%20style%3D%22border-top%3A2px%20solid%20var(--border)%3Bfont-weight%3Abold%22%3E%3Ctd%3ETotal%3C%2Ftd%3E%3Ctd%3E%5C'%20%2B%20totals.total%20%2B%20%5C'%3C%2Ftd%3E%5C'%3B%5Cnfor%20(var%20ri5%20%3D%200%3B%20ri5%20%3C%20RANK_DISPLAY.length%3B%20ri5%2B%2B)%20%7B%5Cnhtml%20%2B%3D%20%5C'%3Ctd%3E%5C'%20%2B%20(totals%5BString(RANK_DISPLAY%5Bri5%5D)%5D%20%7C%7C%20%5C'-%5C')%20%2B%20%5C'%3C%2Ftd%3E%5C'%3B%5Cn%7D%5Cnhtml%20%2B%3D%20%5C'%3C%2Ftr%3E%5C'%3B%5Cntbody.innerHTML%20%3D%20html%3B%5Cn%7D)()%3B%5Cn%2F%2F%20%3D%3D%3D%20Tabs%20%3D%3D%3D%5Cndocument.querySelectorAll(%5C'.tab%5C').forEach(function(tab)%20%7B%5Cntab.addEventListener(%5C'click%5C'%2C%20function()%20%7B%5Cndocument.querySelectorAll(%5C'.tab%5C').forEach(function(t)%20%7B%20t.classList.remove(%5C'active%5C')%3B%20%7D)%3B%5Cndocument.querySelectorAll(%5C'.tab-panel%5C').forEach(function(p)%20%7B%20p.classList.remove(%5C'active%5C')%3B%20%7D)%3B%5Cnthis.classList.add(%5C'active%5C')%3B%5Cndocument.getElementById(%5C'panel-%5C'%20%2B%20this.getAttribute(%5C'data-tab%5C')).classList.add(%5C'active%5C')%3B%5Cn%7D)%3B%5Cn%7D)%3B%5Cn%2F%2F%20%3D%3D%3D%20Image%20Export%20(two-column)%20%3D%3D%3D%5Cndocument.getElementById(%5C'btnExportImg%5C').addEventListener(%5C'click%5C'%2C%20function()%20%7B%5Cnvar%20canvas%20%3D%20document.getElementById(%5C'exportCanvas%5C')%3B%5Cnvar%20ctx%20%3D%20canvas.getContext(%5C'2d%5C')%3B%5Cnvar%20rowH%20%3D%2028%3B%5Cnvar%20headerH%20%3D%2040%3B%5Cnvar%20titleH%20%3D%2060%3B%5Cnvar%20footerH%20%3D%2030%3B%5Cnvar%20colGap%20%3D%2016%3B%5Cnvar%20cols%20%3D%20%5B34%2C%20250%2C%2054%2C%2034%2C%2060%2C%2050%2C%2060%5D%3B%5Cnvar%20tableW%20%3D%200%3B%5Cnfor%20(var%20ci%20%3D%200%3B%20ci%20%3C%20cols.length%3B%20ci%2B%2B)%20tableW%20%2B%3D%20cols%5Bci%5D%3B%5CntableW%20%2B%3D%2016%3B%5Cnvar%20rowCount%20%3D%20Math.min(top50Charts.length%2C%2025)%3B%5Cnvar%20hasTwoCols%20%3D%20top50Charts.length%20%3E%2025%3B%5Cnvar%20totalW%20%3D%20hasTwoCols%20%3F%20(tableW%20*%202%20%2B%20colGap)%20%3A%20tableW%3B%5Cnvar%20totalH%20%3D%20titleH%20%2B%20headerH%20%2B%20(rowCount%20*%20rowH)%20%2B%20footerH%3B%5Cncanvas.width%20%3D%20totalW%3B%5Cncanvas.height%20%3D%20totalH%3B%5Cn%2F%2F%20Background%5Cnctx.fillStyle%20%3D%20%5C'%23fef6f0%5C'%3B%5Cnctx.fillRect(0%2C%200%2C%20totalW%2C%20totalH)%3B%5Cn%2F%2F%20Title%20area%5Cnvar%20tier%20%3D%20getTier(popClassValue)%3B%5Cnctx.fillStyle%20%3D%20tier.color%3B%5Cnctx.font%20%3D%20%5C'bold%2024px%20Segoe%20UI%2C%20sans-serif%5C'%3B%5Cnctx.fillText(%22Pop%5C'n%20Score%20Tool%22%2C%2010%2C%2030)%3B%5Cnvar%20titleRight%20%3D%2010%20%2B%20ctx.measureText(%22Pop%5C'n%20Score%20Tool%22).width%20%2B%2016%3B%5Cnvar%20chara%20%3D%20DATA.player%20%26%26%20DATA.player%5B%5C'%5C%5Cu4f7f%5C%5Cu7528%5C%5Cu30ad%5C%5Cu30e3%5C%5Cu30e9%5C%5Cu30af%5C%5Cu30bf%5C%5Cu30fc%5C'%5D%3B%5Cnvar%20avatarSize%20%3D%2036%3B%5Cnvar%20hasAvatar%20%3D%20chara%20%26%26%20chara.imgData%3B%5Cnvar%20textLeft%20%3D%20hasAvatar%20%3F%20titleRight%20%2B%20avatarSize%20%2B%208%20%3A%20titleRight%3B%5Cnctx.fillStyle%20%3D%20%5C'%233d2b1f%5C'%3B%5Cnctx.font%20%3D%20%5C'16px%20Segoe%20UI%2C%20sans-serif%5C'%3B%5Cnvar%20playerName%20%3D%20(DATA.player%20%26%26%20DATA.player%5B%5C'%5C%5Cu30d7%5C%5Cu30ec%5C%5Cu30fc%5C%5Cu30e4%5C%5Cu30fc%5C%5Cu540d%5C'%5D)%20%7C%7C%20%5C'%5C'%3B%5Cnctx.fillText(playerName%20%2B%20%22%20%20Pop%5C'n%20Class%3A%20%22%20%2B%20popClassValue.toFixed(2)%20%2B%20%5C'%20(%5C'%20%2B%20tier.name%20%2B%20%5C')%5C'%2C%20textLeft%2C%2030)%3B%5Cnctx.fillStyle%20%3D%20%5C'%23907860%5C'%3B%5Cnctx.font%20%3D%20%5C'11px%20Segoe%20UI%2C%20sans-serif%5C'%3B%5Cnctx.fillText(%5C'Top%2050%20Charts%5C'%2C%20textLeft%2C%2048)%3B%5Cnvar%20headers%20%3D%20%5B%5C'%23%5C'%2C%20%5C'Genre%20%2F%20Title%5C'%2C%20%5C'Diff%5C'%2C%20%5C'Lv%5C'%2C%20%5C'Score%5C'%2C%20%5C'Medal%5C'%2C%20%5C'Pts%5C'%5D%3B%5Cnfunction%20drawTable(startIdx%2C%20endIdx%2C%20offsetX)%20%7B%5Cnvar%20y%20%3D%20titleH%3B%5Cnctx.fillStyle%20%3D%20%5C'%23ffe0d0%5C'%3B%5Cnctx.fillRect(offsetX%2C%20y%2C%20tableW%2C%20headerH)%3B%5Cnctx.fillStyle%20%3D%20%5C'%23907860%5C'%3B%5Cnctx.font%20%3D%20%5C'bold%2012px%20Segoe%20UI%2C%20sans-serif%5C'%3B%5Cnvar%20x%20%3D%20offsetX%20%2B%208%3B%5Cnfor%20(var%20hi%20%3D%200%3B%20hi%20%3C%20headers.length%3B%20hi%2B%2B)%20%7B%5Cnctx.fillText(headers%5Bhi%5D%2C%20x%2C%20y%20%2B%2026)%3B%5Cnx%20%2B%3D%20cols%5Bhi%5D%3B%5Cn%7D%5Cny%20%2B%3D%20headerH%3B%5Cnctx.font%20%3D%20%5C'12px%20Segoe%20UI%2C%20sans-serif%5C'%3B%5Cnfor%20(var%20ri%20%3D%20startIdx%3B%20ri%20%3C%20endIdx%3B%20ri%2B%2B)%20%7B%5Cnvar%20c%20%3D%20top50Charts%5Bri%5D%3B%5Cnif%20((ri%20-%20startIdx)%20%25%202%20%3D%3D%3D%200)%20%7B%5Cnctx.fillStyle%20%3D%20%5C'%23fff0ea%5C'%3B%5Cnctx.fillRect(offsetX%2C%20y%2C%20tableW%2C%20rowH)%3B%5Cn%7D%5Cnx%20%3D%20offsetX%20%2B%208%3B%5Cnctx.fillStyle%20%3D%20%5C'%23907860%5C'%3B%5Cnctx.fillText((ri%20%2B%201).toString()%2C%20x%2C%20y%20%2B%2019)%3B%5Cnx%20%2B%3D%20cols%5B0%5D%3B%5Cnctx.fillStyle%20%3D%20%5C'%233d2b1f%5C'%3B%5Cnvar%20titleText%20%3D%20displayTitle(c.title%2C%20c.genre)%3B%5Cnif%20(titleText.length%20%3E%2028)%20titleText%20%3D%20titleText.substring(0%2C%2026)%20%2B%20%5C'...%5C'%3B%5Cnctx.fillText(titleText%2C%20x%2C%20y%20%2B%2019)%3B%5Cnx%20%2B%3D%20cols%5B1%5D%3B%5Cnctx.fillStyle%20%3D%20DIFF_COLORS%5Bc.diff%5D%20%7C%7C%20%5C'%233d2b1f%5C'%3B%5Cnctx.fillText(c.diff.toUpperCase()%2C%20x%2C%20y%20%2B%2019)%3B%5Cnx%20%2B%3D%20cols%5B2%5D%3B%5Cnctx.fillStyle%20%3D%20%5C'%233d2b1f%5C'%3B%5Cnctx.fillText(c.level.toString()%2C%20x%2C%20y%20%2B%2019)%3B%5Cnx%20%2B%3D%20cols%5B3%5D%3B%5Cnctx.fillText(c.score%20%3E%200%20%3F%20c.score.toString()%20%3A%20%5C'-%5C'%2C%20x%2C%20y%20%2B%2019)%3B%5Cnx%20%2B%3D%20cols%5B4%5D%3B%5Cnctx.fillStyle%20%3D%20MEDAL_COLORS%5Bc.medal%5D%20%7C%7C%20%5C'%23907860%5C'%3B%5Cnctx.fillText(MEDAL_LABELS%5Bc.medal%5D%20%7C%7C%20c.medal%2C%20x%2C%20y%20%2B%2019)%3B%5Cnx%20%2B%3D%20cols%5B5%5D%3B%5Cnctx.fillStyle%20%3D%20%5C'%23e94560%5C'%3B%5Cnctx.fillText(c.classPoints.toFixed(2)%2C%20x%2C%20y%20%2B%2019)%3B%5Cny%20%2B%3D%20rowH%3B%5Cn%7D%5Cn%7D%5CndrawTable(0%2C%20Math.min(top50Charts.length%2C%2025)%2C%200)%3B%5Cnif%20(hasTwoCols)%20%7B%5CndrawTable(25%2C%20top50Charts.length%2C%20tableW%20%2B%20colGap)%3B%5Cn%7D%5Cn%2F%2F%20Footer%5Cnctx.fillStyle%20%3D%20%5C'%23907860%5C'%3B%5Cnctx.font%20%3D%20%5C'10px%20Segoe%20UI%2C%20sans-serif%5C'%3B%5Cnctx.fillText(%22Generated%20by%20Pop%5C'n%20Score%20Tool%20%7C%20%22%20%2B%20(DATA.exportedAt%20%7C%7C%20%5C'%5C')%2C%2010%2C%20totalH%20-%2010)%3B%5Cn%2F%2F%20Download%20(async%20if%20avatar%20needs%20loading)%5Cnfunction%20doDownload()%20%7B%5Cnvar%20link%20%3D%20document.createElement(%5C'a%5C')%3B%5Cnlink.download%20%3D%20%5C'popn_class_top50.png%5C'%3B%5Cnlink.href%20%3D%20canvas.toDataURL(%5C'image%2Fpng%5C')%3B%5Cnlink.click()%3B%5Cn%7D%5Cnif%20(hasAvatar)%20%7B%5Cnvar%20avatarImg%20%3D%20new%20Image()%3B%5CnavatarImg.onload%20%3D%20function()%20%7B%5Cnctx.drawImage(avatarImg%2C%20titleRight%2C%2012%2C%20avatarSize%2C%20avatarSize)%3B%5CndoDownload()%3B%5Cn%7D%3B%5CnavatarImg.onerror%20%3D%20doDownload%3B%5CnavatarImg.src%20%3D%20chara.imgData%3B%5Cn%7D%20else%20%7B%5CndoDownload()%3B%5Cn%7D%5Cn%7D)%3B%5Cn%2F%2F%20%3D%3D%3D%20Utility%20%3D%3D%3D%5Cnfunction%20esc(s)%20%7B%5Cnif%20(!s)%20return%20%5C'%5C'%3B%5Cnreturn%20s.replace(%2F%26%2Fg%2C%20%5C'%26amp%3B%5C').replace(%2F%3C%2Fg%2C%20%5C'%26lt%3B%5C').replace(%2F%3E%2Fg%2C%20%5C'%26gt%3B%5C').replace(%2F%22%2Fg%2C%20%5C'%26quot%3B%5C')%3B%5Cn%7D%5Cnfunction%20displayTitle(title%2C%20genre)%20%7B%5Cnif%20(!genre%20%7C%7C%20genre%20%3D%3D%3D%20title)%20return%20title%3B%5Cnvar%20baseTitle%20%3D%20title.replace(%2F%20%5C%5C%5BUPPER%5C%5C%5D%24%2F%2C%20%5C'%5C')%3B%5Cnif%20(genre%20%3D%3D%3D%20baseTitle)%20return%20title%3B%5Cnreturn%20genre%20%2B%20%5C'%20%2F%20%5C'%20%2B%20title%3B%5Cn%7D%5Cn%3C%2Fscript%3E%5Cn%3C%2Fbody%3E%5Cn%3C%2Fhtml%3E'%3B%20function%20exportViewerHTML()%20%7B%20var%20exportData%20%3D%20%7B%20player%3A%20collectedData.player%2C%20scores%3A%20collectedData.scores%2C%20exportedAt%3A%20collectedData.exportedAt%2C%20%7D%3B%20log('Generating%20viewer%20HTML...')%3B%20var%20html%20%3D%20VIEWER_TEMPLATE.replace('%7B%7BDATA_PLACEHOLDER%7D%7D'%2C%20JSON.stringify(exportData))%3B%20var%20blob%20%3D%20new%20Blob(%5Bhtml%5D%2C%20%7B%20type%3A%20'text%2Fhtml'%20%7D)%3B%20var%20viewUrl%20%3D%20URL.createObjectURL(blob)%3B%20window.open(viewUrl%2C%20'_blank')%3B%20var%20dlUrl%20%3D%20URL.createObjectURL(blob)%3B%20var%20a%20%3D%20document.createElement('a')%3B%20a.href%20%3D%20dlUrl%3B%20a.download%20%3D%20'popn_viewer_'%20%2B%20new%20Date().toISOString().slice(0%2C%2010)%20%2B%20'.html'%3B%20document.body.appendChild(a)%3B%20a.click()%3B%20document.body.removeChild(a)%3B%20URL.revokeObjectURL(dlUrl)%3B%20log('Opened%20viewer%20%2B%20downloaded%20HTML')%3B%20%7D%20createUI()%3B%20log(%22Pop'n%20Score%20Tool%20initialized%22)%3B%20setMsg1('Ready.%20Click%20Scrape%20to%20start.')%3B%20setMsg2('')%3B%20setButtonState('idle')%3B%20%7D)()%3B